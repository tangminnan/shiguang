<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="keywords" content="" />
    <meta name="description" content="" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>镜片成品新增</title>
    <link rel="stylesheet" href="/css/css.css" type="text/css">
</head>

<body>
    <form class="form-horizontal m-t" id="signupForm">
        <div class="new_h3">镜片成品新增</div>

        <!--必填项-->
        <div class="m40 tabS PHGL">
            <h3>必填项</h3>
            <table border="0" cellspacing="0" cellpadding="0">
                <tbody>
                    <tr>
                        <td>商品代码：</td>
                        <td>
                            <input id="producNum" name="producNum" type="text" value="3.00.00.000000000.0000" />
                        </td>
                        <td>商品条码：</td>
                        <td>
                            <input id="producCode" name="producCode" type="text" value="300000000000000000" />
                            <em>*</em>
                        </td>
                        <td>商品名称：</td>
                        <td><input id="producName" name="producName" type="text" />
                            <em>*</em>
                        </td>
                    </tr>
                    <tr>
                        <td>制造商：</td>
                        <td>
                            <input id="mfrsid" name="mfrsid" type="hidden" />
                            <input id="mfrsnum" name="mfrsnum" type="hidden" />
                            <input id="mfrsName" name="mfrsName" type="text" readonly />
                            <input id="goodsids" name="goodsids" value="4" type="hidden" />
                            <input type="button" class="XZ-btn" value="选择" onclick="getMfrs()" />
                            <em>*</em>
                        </td>
                        <td>商品品种</td>
                        <td style="width:20%;">
                            <select id="brandnum" name="brandnum" onchange="change(this, 5, 7)">
                                <option value="">--请选择--</option>
                            </select>
                            <em>*</em>
                        </td>
                        <td>商品编号：</td>
                        <td>
                            <input id="proid" name="proid" type="text" />
                            <em>*</em>
                        </td>
                    </tr>
                    <tr>
                        <td>计量单位：</td>
                        <td>
                            <select id="unitid" name="unitid">
                                <option></option>
                                <option th:each="ls:${unitDOList}" th:text="${ls.unitname}" th:value="${ls.unitid}">
                                </option>
                            </select>
                            <em>*</em>
                        </td>
                        <td>球镜：</td>
                        <td>
                            <select id="sphId" name="sphId" onchange="change1(this,cylId)">
                                <option value="">--请选择--</option>
                                <option th:each="ls:${sphDOList}" th:text="${ls.sph}" th:value="${ls.sphId}"></option>
                            </select>
                            <em>*</em>
                        </td>
                        <td>柱镜：</td>
                        <td>
                            <select id="cylId" name="cylId" class="form-control" onchange="change1(sphId,this)">
                                <option value="">--请选择--</option>
                                <option th:each="ls:${cylDOList}" th:text="${ls.cyl}" th:value="${ls.cylId}"></option>
                            </select>
                            <em>*</em>
                        </td>
                    </tr>
                    <tr>
                        <td>下加光：</td>
                        <td>
                            <select id="lightbelowId" name="lightbelowId">
                                <option value="">--请选择--</option>
                                <option th:each="ls:${lightbelowDOList}" th:text="${ls.lightbelow}"
                                    th:value="${ls.lightbelowId}"></option>
                            </select>
                        </td>
                        <td>材料分类：</td>
                        <td>
                            <select id="lensId" name="lensId">
                                <option value="">--请选择--</option>
                                <option th:each="ls:${lensDOList}" th:text="${ls.lensName}" th:value="${ls.lensId}">
                                </option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <!--<td>批号管理：</td>-->
                        <!--<td>-->
                            <!--<input name="batchid" value="1" type="radio" id="PH-S"> <label for="PH-S"-->
                                <!--style="margin-right: 5%">是</label>-->
                            <!--<input name="batchid" value="2" type="radio" id="PH-F" checked> <label for="PH-F">否</label>-->
                            <!--<em>*</em>-->
                        <!--</td>-->
                        <td>销售状态：</td>
                        <td>
                            <input name="xsstate" value="1" id="PH-S" type="radio"> <label for="PH-S"
                                style="margin-right: 5%">禁用</label>
                            <input name="xsstate" value="0" id="PH-F" type="radio" checked> <label for="PH-F">启用</label>
                            <em>*</em>
                        </td>
                        <td>镜片类型：</td>
                        <td>
                            <input name="classtype" value="1"  type="radio" checked  onclick="return false"> <label for="PH-S"
                                                                                  style="margin-right: 5%">成品片</label>
                            <input name="classtype" value="2"  type="radio"  onclick="return false"> <label for="PH-F">定做片</label>
                            <em>*</em>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <!--非必填项2-->
        <div class="m40 tabS PHGL">
            <h3>非必填项</h3>
            <table border="0" cellspacing="0" cellpadding="0">
                <tbody>
                    <tr>
                        <td>光度分类：</td>
                        <td>
                            <select id="lightId" name="lightId" onchange="lightIdstr()">
                                <option value="">--请选择--</option>
                                <option th:each="ls:${lightDOList}" th:text="${ls.lightName}" th:value="${ls.lightId}">
                                </option>
                            </select>
                        </td>
                        <td>渐进片分类：</td>
                        <td style="width:20%;">
                            <select id="gradualId" name="gradualId" class="form-control" style="display: none">
                                <option th:each="ls:${gradualDOList}" th:text="${ls.gradualName}"
                                    th:value="${ls.gradualId}"></option>
                            </select>
                        </td>
                        <td>折射率：</td>
                        <td style="width:20%;">
                            <select id="refractivityid" name="refractivityid" class="form-control">
                                <option></option>
                                <option th:each="ls:${refractivityDOList}" th:text="${ls.refractivityvalue}"
                                    th:value="${ls.refractivityid}"></option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>镜片功能：</td>
                        <td>
                            <select id="functionId" name="functionId" class="form-control">
                                <option></option>
                                <option th:each="ls:${functionDOList}" th:text="${ls.functionName}"
                                    th:value="${ls.functionId}"></option>
                            </select>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!--价格项-->
        <div class="m40 tabS PHGL">
            <h3>价格项</h3>
            <table border="0" cellspacing="0" cellpadding="0">
                <tbody>
                    <tr>
                        <td>税率（%）：</td>
                        <td>
                            <input id="tax" name="tax" type="text" value="17"
                                oninput="value=value.replace(/[^\d]/g,'')" />
                            <em>*</em>
                        </td>
                        <td>含税单价：</td>
                        <td>
                            <input id="taxPrice" name="taxPrice" type="text" oninput="getmoney(this,10)" autofocus />
                            <em>*</em>
                        </td>
                        <td>批发价格：</td>
                        <td colspan="3">
                            <input id="tradePrice" name="tradePrice" type="text" style="width: 60%"
                                oninput="getmoney(this,10)" autofocus />
                            <em>*</em>
                        </td>
                    </tr>
                    <tr>
                        <td>调货成本：</td>
                        <td>
                            <input id="transferPrice" name="transferPrice" type="text" oninput="getmoney(this,10)"
                                autofocus />
                            <em>*</em>
                        </td>
                        <td>标准零售价格：</td>
                        <td colspan="3">
                            <input id="retailPrice" name="retailPrice" type="text" style="width: 29%"
                                oninput="getmoney(this,10)" autofocus />
                            <em>*</em>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!--保存/清空-->
        <div class="BQ-btn">
            <!--未删除-->
            <input id="producFactory" name="producFactory" value="" type="hidden">
            <input id="state" name="state" value="1" type="hidden">
            <input type="button" value="保存" onclick="baocun()" />
            <!--<input type="button" class="empty" value="清空"/>-->
            <dl>
                <dt>镜片（成品）<br />商品代码组成说明</dt>
                <dd><img src="/img/jpcp.png" alt="" /></dd>
                <dd>商品条码会根据商品代码自动生成。<br />商品名称默认为选择的品种的名称，可以自行调整。<br />型号通常是写在镜腿上的规格。</dd>
            </dl>
        </div>
    </form>
    <div th:include="include::footer"></div>
    <script type="text/javascript" src="/js/appjs/product/jpcp/add.js"></script>
    <script type="text/javascript" src="/js/appjs/mfrs/brand/findmfrs.js"></script>
    <script type="text/javascript">
        $(function () {
            $("input[type='checkbox']").click(function () {
                this.checked = !this.checked;
            });
        });
        $(function () {
            $("input[type='radio']").click(function () {
                this.checked = !this.checked;
            });
        });
        function baocun() {
            //商品名称
            var producName = document.getElementById('producName').value;
            //制造商
            var mfrsName = document.getElementById('mfrsName').value;
            //商品品种
            var brandnum = document.getElementById('brandnum').value;
            //商品编号
            var proid = document.getElementById('proid').value;
            //计量单位
            var unitid = document.getElementById('unitid').value;
            //球镜
            var sphId = document.getElementById('sphId').value;
            //柱镜
            var cylId = document.getElementById('cylId').value;
            //税率
            var tax = document.getElementById('tax').value;
            //含税单价
            var taxPrice = document.getElementById('taxPrice').value;
            //批发价格
            var tradePrice = document.getElementById('tradePrice').value;
            //调货成本
            var transferPrice = document.getElementById('transferPrice').value;
            //标准零售价格
            var retailPrice = document.getElementById('retailPrice').value;
            if (mfrsName == "") {
                layer.alert("请选择制造商");
            } else if (producName == "") {
                layer.alert("请输入商品名称");
            } else if (brandnum == "") {
                layer.alert("请选择商品品种");
            } else if (proid == "") {
                layer.alert("请输入商品编号");
            } else if (unitid == "") {
                layer.alert("请选择计量单位");
            } else if (sphId == "") {
                layer.alert("请选择球镜");
            } else if (cylId == "") {
                layer.alert("请选择柱镜");
            } else if (tax == "") {
                layer.alert("请输入税率");
            } else if (taxPrice == "") {
                layer.alert("请输入含税单价");
            } else if (tradePrice == "") {
                layer.alert("请输入批发价格");
            } else if (transferPrice == "") {
                layer.alert("请输入调货成本");
            } else if (retailPrice == "") {
                layer.alert("请输入标准零售价格");
            } else {
                save();
            }
        }

    </script>
    <script type="text/javascript">
        //———制造商与品种联动
        function choice(value) {
            // layer.alert(value);
            $("#brandnum").empty("");
            $("#brandnum").append("<option value=\"\">--请选择--</option>");
            $.ajax({
                url: "/product/produca/choice",
                type: "post",
                data: {
                    'mfrsid': value,
                    'goodsid': 3
                },
                dataType: 'JSON',
                async: false,
                success: function (datajson) {
                    $(datajson).each(function (key) {
                        // var id = datajson[key].brandid;
                        var num = datajson[key].brandnum;
                        var roleName = datajson[key].brandname;
                        $("#brandnum").append("<option value='" + num + "'>" + roleName + "</option>")
                    });
                }
            });
        }

        var a1 = document.getElementById("producNum");
        var a2 = document.getElementById("producCode");
        var cylId = document.getElementById("cylId");
        var sphId = document.getElementById("sphId");
        // console.log(cylId);
        // console.log(sphId);
        var sum;
        var a1_val = "3.00.00.000000000.0000";
        function change(e, k, s) {
            a1.value = a1.value.substring(0, k) + e.value + a1.value.substring(s, 22);
            a1_val = a1.value.substring(0, 7) + a1_val.substring(7, 22);
            a2.value = a1.value.replace(".", "").replace(".", "").replace(".", "").replace(".", "");//黏贴
        }
        function change1(e, err) {
            var select1_val = e.options[e.options.selectedIndex].innerText
            var select2_val = err.options[err.options.selectedIndex].innerText
            // layer.alert(e.value,err.value)
            if (e.value == "") {
                select1_val = 0
                //    layer.alert(select1_val)
            } else if (err.value == "") {
                select2_val = 0
                // layer.alert(select2_val)
            }
            // console.log(select1_val,select2_val);
            select1_val = ZF(select1_val)
            select2_val = ZF(select2_val)
            sum = select1_val.replace(".", "").replace("+", "").replace("-", "")
                + select2_val.replace(".", "").replace("+", "").replace("-", "")
            a1.value = a1.value.substring(0, 8) + sum.padEnd("9", "000000000") + a1.value.substring(17, 22);
            a2.value = a1.value.replace(".", "").replace(".", "").replace(".", "").replace(".", "");
            console.log(a1.value.substring(18, 22));
        }
        function ZF(e) {
            // layer.alert(e.indexOf("+"))
            if (e.indexOf("+") == 0) {
                e = "Z" + e
            } else {
                e = "F" + e
            }
            return e
        }
        /**
         * 限制输入框只能输入数字和最大长度* 如果是小数只能输入到小数点后两位
         */
        function getmoney(obj, maxLen) {
            if (maxLen && obj.value.length > maxLen) {//判断长度
                obj.value = obj.value.slice(0, 10);
            }
            //修复第一个字符是小数点 的情况.
            if (obj.value !== '' && obj.value.substr(0, 1) === '.') {
                obj.value = "";
            }
            //解决 粘贴不生效
            obj.value = obj.value.replace(/^0*(0\.|[1-9])/, '$1');
            //清除“数字”和“.”以外的字符
            obj.value = obj.value.replace(/[^\d.]/g, "");
            //只保留第一个小数点(.)清除多余的
            obj.value = obj.value.replace(/\.{2,}/g, ".");
            obj.value = obj.value.replace(".", "$#$").replace(/\./g, "").replace("$#$", ".");
            //只能输入两个小数
            obj.value = obj.value.replace(/^(\d+)\.(\d\d).*$/, '$1.$2');
            if (obj.value.indexOf(".") < 0 && obj.value !== "") {//以上已经过滤，此处控制的是如果没有小数点，首位不能为类似于 01、02的金额
                if (obj.value.substr(0, 1) === '0' && obj.value.length === 2) {
                    obj.value = obj.value.substr(1, obj.value.length);
                }
            }
        }

        // <!--//——— //根据光度分类选择控制渐进片分类显隐—————-->

        function lightIdstr() {
            var lightId = $("#lightId option:selected").text();
            if (lightId == '单光') {
                gradualId.style = "display: none";
            } else if (lightId == '抗疲劳') {
                gradualId.style = "display: none";
            } else if (lightId == '多光') {
                gradualId.style = "display: none";
            } else if (lightId == '其他') {
                gradualId.style = "display: none";
            } else if (lightId == '渐进') {
                gradualId.style = "display: block";
            }
        }
    </script>
</body>

</html>