<!doctype html>
<html>
<head th:include="include :: header"></head>
<head>
	<meta charset="utf-8">
	<meta name="keywords" content="" />
	<meta name="description" content="" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<title>验光师</title>
	<link rel="stylesheet" href="/css/css.css" type="text/css">
	<script type="text/javascript" src="/js/jquery-1.11.3.min.js"></script>
	<script type="text/javascript" src="/js/jquery.SuperSlide.2.1.1.js"></script>
</head>
<body>
<!--查询条件-->
<div class="m40 tabS msgBox">
	<h3>查询条件</h3>
	<table border="0" cellspacing="0" cellpadding="0">
		<tr>
			<td>所属公司 </td>
			<td>
				<select id="companyId" name="companyId" onchange="selectgoods()" style="width: 200px">
					<option></option>
					<option th:each="ls:${companyList}"
							th:text="${ls.name}"
							th:value="${ls.id}"></option>
				</select>
			</td>
			<td>查询日期 </td>
			<td>
				<input id="settleDateStart" name="settleDateStart" placeholder="开始日期" type="text" readonly/>至<input id="settleDateEnd" name="settleDateEnd" placeholder="结束日期" type="text" readonly/>
			</td>
		</tr>
		<tr>
			<td>销售门店：</td>
			<td colspan="4">
				<label class="text">
					<textarea id="department" name="department" rows="3" readonly></textarea>
					<input type="button" class="XZ-btn" value="选择" onclick="choiceDepartment()"/>
				</label>
			</td>

		</tr>
		<tr>
			<td>商品类型：</td>
			<td>
				<select id="goodsid" name="goodsid" onchange="selectgoods()" style="width: 200px">
					<option></option>
					<option th:each="ls:${goodsDOList}"
							th:text="${ls.goodsname}"
							th:value="${ls.goodsid}"></option>
				</select>
				<!--<div id="jp" style="display: none">-->
					<!--<label class="radio-inline">-->
						<!--<input type="radio" name="classtype"  value="1" /> 成品片-->
					<!--</label>-->
					<!--<label class="radio-inline">-->
						<!--<input type="radio" name="classtype" value="2" /> 订做片-->
					<!--</label>-->
				<!--</div>-->
				<!--<input type="hidden" id="classtype" value="" />-->

			</td>
			<td>制造商：</td>
			<td>
				<input id="mfrsname" name="mfrsname" type="text" readonly/>
				<input type="button" class="XZ-btn" value="选择" onclick="choiceMfrs()"/>
			</td>
			<td>商品品种：</td>
			<td>
				<input id="brandname" name="brandname" type="text" readonly style="background-color: #e4e4e4" />
				<input type="button" class="XZ-btn" value="选择" onclick="choiceBrand()"/>
			</td>
		</tr>

	</table>
	<!--保存/清空-->
	<div class="BQ-btn">
		<input type="button" value="查询" onclick="reLoad()"/>
		<input type="button" class="empty" value="清空" onclick="clearText()"/>
	</div>

	<table id="exampleTable" ></table>
</div>
<!--shiro控制bootstraptable行内按钮看见性 来自bootdo的创新方案 -->
<div>
	<script type="text/javascript">
        var s_edit_h = 'hidden';
        var s_remove_h = 'hidden';
        var s_resetPwd_h = 'hidden';
	</script>
</div>
<div shiro:hasPermission="information:optometry:edit">
	<script type="text/javascript">
        s_edit_h = '';
	</script>
</div>
<div shiro:hasPermission="information:optometry:remove">
	<script type="text/javascript">
        var s_remove_h = '';
	</script>
</div>
<div shiro:hasPermission="information:optometry:resetPwd">
	<script type="text/javascript">
        var s_resetPwd_h = '';
	</script>
</div>
<div th:include="include :: footer"></div>
<script type="text/javascript">
    laydate.render({
        elem: '#settleDateStart',
        format: 'yyyy-MM-dd',
        type: 'date'
    });
    laydate.render({
        elem: '#settleDateEnd',
        format: 'yyyy-MM-dd',
        type: 'date'
    });
    function choiceDepartment() {
        var companyId = $("#companyId").val();
        if(companyId==""){
            companyId=0
		}
        var toIndex = layer.open({
            type: 2,
            title: '销售门店',
            maxmin: true,
            shadeClose: false, // 点击遮罩关闭层
            area: ['800px', '520px'],
            content: "/information/saleYanguang/findcompany/" + companyId,// iframe的url
            cancel: function (index, layero) {
                var rows = $(layero).find("iframe")[0].contentWindow.batchSelect();
				var array="";
                for (var i = 0; i < rows.length; i++) {
                    array+=rows[i].departName+",";
                }
                $("#department").val(array);
            }
        });
        layer.full(toIndex);
    }
    function choiceMfrs() {
        var goodsid = document.getElementById('goodsid').value;
        if (goodsid == "") {
            layer.alert("请选择商品类型！");
        } else {
            //选择镜架
            var toIndex = layer.open({
                type: 2,
                title: '制造商',
                maxmin: true,
                shadeClose: false, // 点击遮罩关闭层
                area: ['800px', '520px'],
                content: "/product/produca/findmfrs/" + goodsid,// iframe的url
                cancel: function (index, layero) {
                    var rows = $(layero).find("iframe")[0].contentWindow.batchSelect();
                    for (var i = 0; i < rows.length; i++) {
                        $("#mfrsname").val(rows[i].mfrsname);
                        $("#mfrsid").val(rows[i].mfrsnum);
                        // alert(rows[i].mfrsnum)
                        // $("#mfrsNames").val(rows[i].mfrsname);
                    }
                }
            });
            layer.full(toIndex);
        }
    }
    function choiceBrand() {
        var goodsid = document.getElementById('goodsid').value;
        var mfrsname = document.getElementById('mfrsname').value;
        if (mfrsname == "") {
            layer.alert("请选择制造商！");
        } else {
            //选择镜架
            var toIndex = layer.open({
                type: 2,
                title: '商品品种',
                maxmin: true,
                shadeClose: false, // 点击遮罩关闭层
                area: ['800px', '520px'],
                content: "/kucun/stock/findbrand/" + mfrsname+"/"+goodsid,// iframe的url
                cancel: function (index, layero) {
                    var rows = $(layero).find("iframe")[0].contentWindow.batchSelect();
                    for (var i = 0; i < rows.length; i++) {
                        $("#brandname").val(rows[i].brandname);
                        $("#brandnum").val(rows[i].brandnum);
                        // $("#brandNames").val(rows[i].brandname);
                    }
                }
            });
            layer.full(toIndex);
        }
    }


    //清空
    function clearText() {
       	$("#department").val("");
        var controls = document.getElementsByTagName('input');
        for (var i = 0; i < controls.length; i++) {
            if (controls[i].type == 'text') {
                controls[i].value = '';
            }
        }

    }

    function reLoad() {
        var companyId = $("#companyId").val();
        var settleDateStart = $("#settleDateStart").val();
        var settleDateEnd = $("#settleDateEnd").val();
        var department = $("#department").val();
        var goodsid = $("#goodsid").val();
        var mfrsname = $("#mfrsname").val();
        var brandname = $("#brandname").val();
        window.open("/information/saleYanguang/findall/?companyId=" + companyId + "&settleDateStart=" + settleDateStart
			+ "&settleDateEnd=" + settleDateEnd+ "&department=" + department
			+ "&goodsid=" + goodsid+ "&mfrsname=" + mfrsname+ "&brandname=" + brandname);
    }
</script>
</body>
</html>