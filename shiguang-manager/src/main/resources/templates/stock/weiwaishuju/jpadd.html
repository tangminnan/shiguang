<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="keywords" content=""/>
    <meta name="description" content=""/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <title>收据2</title>
    <style type="text/css">
        * {
            padding: 0;
            margin: 0;
            box-sizing: border-box;
            font-size: 14px;
        }

        .main {
            margin: 25px;
        }

        input[type="text"], select, textarea {
            width: 100%;
            line-height: 28px;
            outline: none;
            padding: 2px 10px;
            border: 1px solid #ddd;
        }

        select {
            height: 32px;
        }

        textarea {
            height: auto;
            font-size: 14px;
            resize: none;
        }

        h3 {
            font-size: 18px;
            margin-bottom: 10px;
        }

        table {
            width: 100%;
            text-align: center;
            margin-bottom: 20px;
        }

        table td {
            height: 36px;
            padding: 2px;
            border-bottom: 2px solid #fff;
            border-right: 2px solid #fff;
        }

        .tabA {
            background: #e9f0fa;
        }

        .tabA td:nth-child(odd) {
            background: #cddfeb;
        }

        .Xze, .qingK {
            width: 80px;
            height: 32px;
            margin-left: 10px;
            background: #0091f2;
            color: #fff;
            border: 1px solid #fff;
            outline: none;
            border-radius: 5px;
        }

        .tabB {
            background: #d4f2da;
        }

        .tabB td {
            width: 9.09%;
        }

        .tabB input, .tabC input {
            text-align: center;
        }

        .Add {
            width: 60%;
            height: 32px;
            background: #24c543;
            color: #fff;
            border: 1px solid #fff;
            outline: none;
            border-radius: 5px;
        }

        .tabC {
            background: #cbdde7;
        }

        .qingK {
            margin-left: 0;
        }

        .allpik input {
            width: 150px;
            height: 42px;
            font-size: 16px;
            letter-spacing: 2px;
            background: #0091f2;
            color: #fff;
            border: 2px solid #e9f0fa;
            outline: none;
            border-radius: 5px;
        }

        .tabB1 {
            background: #f6e2ee;
        }

        .tabB1 td {
            width: 12.5%;
        }

        .Add1 {
            width: 60%;
            height: 32px;
            background: #df5eab;
            color: #fff;
            border: 1px solid #fff;
            outline: none;
            border-radius: 5px;
        }

    </style>

</head>
<body>
<form class="form-horizontal m-t" id="signupForm">
    <div class="main">
        <h3>单据信息</h3>
        <input id="eyeStyle" name="eyeStyle" th:value="${eyeStyle}" type="text"/>
        <input id="mfrsid" name="mfrsid" th:value="${mfrsid}" type="text"/>
        <input id="mfrsname" name="mfrsname" th:value="${mfrsname}" type="text"/>
        <table class="tabA" border="0" cellspacing="0" cellpadding="0">
            <tbody>
            <tr>
                <td>销售单号</td>
                <td><input id="number" name="number" th:value="${danjunum}" readonly type="text"/></td>
                <td>单据日期</td>
                <td><input id="danjuDay" name="danjuDay" th:value="${danjuDay}" readonly type="text"/></td>
                <td>所属门店</td>
                <td>
                    <input id="departname" name="departname" th:value="${departmentName}" readonly type="text"/>
                </td>
            </tr>
            <tr>
                <td>制单人</td>
                <td>
                    <input id="zhidanPeople" name="zhidanPeople" th:value="${zhidanPeople}" readonly type="text"/>
                </td>
                <td>镜片型</td>
                <td>
                    <input id="jcStyle" name="jcStyle" th:value="${eyeStyles}" readonly type="text"/>
                </td>
                <td>预计取镜时间</td>
                <td><input readonly id="timetime" name="timetime" type="text"/></td>
            </tr>
            <tr>
                <td>单据类型</td>
                <td>
                    <select id="danjuStyle" name="danjuStyle">
                        <option value="1">外部配镜单</option>
                        <option value="2">回修配镜单</option>
                        <option value="3">报残配镜单</option>
                    </select>
                </td>
                <td>原配镜单</td>
                <td style="text-align:left;">
                    <input id="saleNumber" name="saleNumber" readonly type="text" style="width:80%"/>
                    <input type="button" class="Xze" value="选择" onclick="PeiJing()"/>
                </td>
                <td>委外类型</td>
                <td>
                    <select id="weiwaiStyle" name="weiwaiStyle">
                        <option value="委外订单">委外订单</option>
                        <option value="委外加工">委外加工</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>备注</td>
                <td colspan="5"><textarea name="beizhu" id="beizhu" cols="30" rows="2"></textarea></td>
            </tr>
            </tbody>
        </table>

        <h3>度数录入</h3>
        <table id="jpdushu" class="tabB" border="0" cellspacing="0" cellpadding="0"></table>
        <table id="tab1"  class="tabB" border="0" cellspacing="0" cellpadding="0">
            <tr>
                <td></td>
                <td>球镜</td>
                <td>柱镜</td>
                <td>轴向</td>
                <td>ADD</td>
                <td>三菱镜</td>
                <td>基底</td>
                <td>瞳距（远）</td>
                <td>瞳距（近）</td>
                <!--				<td>选择</td>-->
            </tr>
            <tr>
                <td>OD</td>
                <td><input id="rightsph" name="rightsph" onblur="zhengfu(this)" onkeydown="xiaoshu(this)" type="text"/></td>
                <td><input id="rightcyl" name="rightcyl" onblur="zhengfu(this)" onkeydown="xiaoshu(this)" type="text"/></td>
                <td><input id="rightzx" name="rightzx" onblur="zhouxiang(this)" type="text"/></td>
                <td><input id="rightAdd" name="rightAdd" type="text"/></td>
                <td><input id="rightSlj" name="rightSlj" type="text"/></td>
                <td><input id="rightJd" name="rightJd" type="text"/></td>
                <td><input id="rightFartj" name="rightFartj" type="text"/></td>
                <td><input id="rightNeartj" name="rightNeartj" type="text"/></td>
                <!--				<td><input type="button" class="Add" value="单品添加商品" onclick="getGoods()" /></td>-->
            </tr>
            <tr>
                <td>OS</td>
                <td><input id="leftsph" name="leftsph" onblur="zhengfu(this)" onkeydown="xiaoshu(this)" type="text"/>
                </td>
                <td><input id="leftcyl" name="leftcyl" onblur="zhengfu(this)" onkeydown="xiaoshu(this)" type="text"/>
                </td>
                <td><input id="leftzx" name="leftzx" onblur="zhouxiang(this)" type="text"/></td>
                <td><input id="leftAdd" name="leftAdd" type="text"/></td>
                <td><input id="leftSlj" name="leftSlj" type="text"/></td>
                <td><input id="leftJd" name="leftJd" type="text"/></td>
                <td><input id="leftFartj" name="leftFartj" type="text"/></td>
                <td><input id="leftNeartj" name="leftNeartj" type="text"/></td>
                <!--				<td><input type="button" class="Add" value="单品添加商品" onclick="getGoods()"/></td>-->
            </tr>
        </table>
        <h3>商品列表</h3>
        <table id="jp" class="tabC" border="0" cellspacing="0" cellpadding="0"></table>
        <table id="tab3"   class="tabC" border="0" cellspacing="0" cellpadding="0">
            <tr>
                <td width="250">商品代码</td>
                <td width="250">商品名称</td>
                <td>镜片型</td>
                <td>球镜</td>
                <td>柱镜</td>
                <td>轴向</td>
                <td>下加</td>
                <td>棱镜</td>
                <td>基底</td>
                <td>瞳高</td>
                <td>数量</td>
                <td width="300">加工要求</td>
                <!--<td width="100">操作</td>-->
            </tr>
            <tr>
                <td><input type="text"/></td>
                <td><input type="text"/></td>
                <td><input type="text"/></td>
                <td><input type="text"/></td>
                <td><input type="text"/></td>
                <td><input type="text"/></td>
                <td><input type="text"/></td>
                <td><input type="text"/></td>
                <td><input type="text"/></td>
                <td><input type="text"/></td>
                <td><input type="text"/></td>
                <td><input type="text"/></td>
            </tr>
            <tr>
                <td><input type="text"/></td>
                <td><input type="text"/></td>
                <td><input type="text"/></td>
                <td><input type="text"/></td>
                <td><input type="text"/></td>
                <td><input type="text"/></td>
                <td><input type="text"/></td>
                <td><input type="text"/></td>
                <td><input type="text"/></td>
                <td><input type="text"/></td>
                <td><input type="text"/></td>
                <td><input type="text"/></td>
            </tr>
        </table>
        <input id="gkname" name="gkname" type="hidden"/>
        <input id="hyknum" name="hyknum" type="hidden"/>
        <input id="phone" name="phone" type="hidden"/>


        <div class="allpik"><input type="button" value="保存" onclick="save()"/></div>
    </div>
</form>
<div th:include="include::footer"></div>
<script type="text/javascript" src="/js/appjs/stock/weiwaishuju/add.js"></script>
<script type="text/javascript">
    //日期
    laydate.render({
        elem: '#timetime',
        type: 'date'
    });

    // var flag="";
    // var flags="";
    // var arr = new Array();
    // var countarr = new Array();
    var numAry = new Array();
    var codeAry = new Array();
    var nameAry = new Array();
    var lfs = new Array();
    var mss = new Array();
    var sls = new Array();
    var lxs = new Array();

    function PeiJing() {
        $("#tab1").remove();
        var html = "";
        var bhtml = "";
        var xsNumber="";
        var rightsphs="";
        var rightcyls="";
        var rightzxs="";
        var rightAdds="";
        var rightSljs="";
        var rightJds="";
        var rightFartjs="";
        var rightNeartjs="";

        var leftsphs="";
        var leftcyls="";
        var leftzxs="";
        var leftAdds="";
        var leftSljs="";
        var leftJds="";
        var leftFartjs="";
        var leftNeartjs="";

        var goodsNums="";
        var goodsCodes="";
        var leftRights="";
        var storeNames="";
        var storeDescribes="";
        var storeCounts="";
        var classtypes="";

        var eyeStyle = $('#eyeStyle').val();
        var mfrsid = $('#mfrsid').val();
        var mfrsname = $('#mfrsname').val();
        var toIndex = layer.open({
            type: 2,
            title: '原配镜单',
            maxmin: true,
            shadeClose: false, // 点击遮罩关闭层
            area: ['800px', '520px'],
            content: "/stock/weiwai/PeiJing/" + eyeStyle+ "/" +  mfrsid + "/" +  mfrsname,// iframe的url
            cancel: function (index, layero) {

                var rows = $(layero).find("iframe")[0].contentWindow.batchSelect();
                for (var i = 0; i < rows.length; i++) {
                    $("#departname").val(rows[i].mirorAddress);
                    xsNumber += rows[i].saleNumber + ',';
                    rightsphs += rows[i].rightsph + ',';
                    rightcyls += rows[i].rightcyl + ',';
                    rightzxs += rows[i].rightzx + ',';
                    rightAdds += rows[i].rightAdd + ',';
                    rightSljs += rows[i].rightSlja + ',';
                    rightJds += rows[i].rightJd + ',';
                    rightFartjs += rows[i].rightFartj + ',';
                    rightNeartjs += rows[i].rightNeartj + ',';

                    leftsphs += rows[i].leftsph + ',';
                    leftcyls += rows[i].leftcyl + ',';
                    leftzxs += rows[i].leftzx + ',';
                    leftAdds += rows[i].leftAdd + ',';
                    leftSljs += rows[i].leftSlja + ',';
                    leftJds += rows[i].leftJd + ',';
                    leftFartjs += rows[i].leftFartj + ',';
                    leftNeartjs += rows[i].leftNeartj + ',';

                    // goodsNums += rows[i].goodsNum;
                    // goodsCodes += rows[i].goodsCode;
                    // leftRights += rows[i].leftRight;
                    // storeNames += rows[i].storeName;
                    // storeDescribes += rows[i].storeDescribe;
                    // storeCounts += rows[i].storeCount;
                    // classtypes += rows[i].classtype;



                    numAry[i]=rows[i].goodsNum;
                    codeAry[i]=rows[i].goodsCode;
                    nameAry[i]=rows[i].storeName;
                    lfs[i]=rows[i].leftRight;
                    mss[i]=rows[i].storeDescribe;
                    sls[i]=rows[i].storeCount;
                    lxs[i]=rows[i].classtype;



                    //顾客信息
                    $("#gkname").val(rows[i].name);
                    $("#hyknum").val(rows[i].memberNumber);
                    $("#phone").val(rows[i].phone1);

                }
                if (eyeStyle == 3) {//镜片
                    var allLength=xsNumber.split(",");//单据

                    var rightsph=rightsphs.split(",");
                    var rightcyl=rightsphs.split(",");
                    var rightzx=rightzxs.split(",");
                    var rightAdd=rightAdds.split(",");
                    var rightSlj=rightJds.split(",");
                    var rightJd=rightJds.split(",");
                    var rightFartj=rightFartjs.split(",");
                    var rightNeartj=rightNeartjs.split(",");

                    var leftsph=leftsphs.split(",");
                    var leftcyl=leftcyls.split(",");
                    var leftzx=leftzxs.split(",");
                    var leftAdd=leftAdds.split(",");
                    var leftSlj=leftSljs.split(",");
                    var leftJd=leftJds.split(",");
                    var leftFartj=leftFartjs.split(",");
                    var leftNeartj=leftNeartjs.split(",");
                    for (var b = 0; b< allLength.length-1; b++) {
                        html += "<tr>";
                        html+="<td></td>";
                        html+="<td>球镜</td>";
                        html+="<td>柱镜</td>";
                        html+="<td>轴向</td>";
                        html+="<td>ADD</td>";
                        html+="<td>三菱镜</td>";
                        html+="<td>基底</td>";
                        html+="<td>瞳距（远）</td>";
                        html+="<td>瞳距（近）</td>";
                        html+="</tr>";
                        html+="<tr>";
                        html+="<td>OD</td>";
                        html+="<td><input id='rightsph"+b+"' name='rightsph' value='"+rightsph[b]+"' onblur='zhengfu(this)' onkeydown='xiaoshu(this)' type='text'/></td>";
                        html+="<td><input id='rightcyl"+b+"' name='rightcyl' value='"+rightcyl[b]+"' onblur='zhengfu(this)' onkeydown='xiaoshu(this)' type='text'/></td>";
                        html+="<td><input id='rightzx"+b+"' name='rightzx' value='"+rightzx[b]+"' onblur='zhouxiang(this)' type='text'/></td>";
                        html+="<td><input id='rightAdd"+b+"' name='rightAdd' value='"+rightAdd[b]+"' type='text'/></td>";
                        html+="<td><input id='rightSlj"+b+"' name='rightSlj' value='"+rightSlj[b]+"' type='text'/></td>";
                        html+="<td><input id='rightJd"+b+"' name='rightJd' value='"+rightJd[b]+"' type='text'/></td>";
                        html+="<td><input id='rightFartj"+b+"' name='rightFartj' value='"+rightFartj[b]+"' type='text'/></td>";
                        html+="<td><input id='rightNeartj"+b+"' name='rightNeartj' value='"+rightNeartj[b]+"'  type='text'/></td>";
                        html+="</tr>";
                        html+="<tr>";
                        html+="<td>OS</td>";
                        html+="<td><input id='leftsph"+b+"' name='leftsph' value='"+leftsph[b]+"' onblur='zhengfu(this)' onkeydown='xiaoshu(this)' type='text'/></td>";
                        html+="<td><input id='leftcyl"+b+"' name='leftcyl' value='"+leftcyl[b]+"' onblur='zhengfu(this)' onkeydown='xiaoshu(this)' type='text'/></td>";
                        html+="<td><input id='leftzx"+b+"'name='leftzx' value='"+leftzx[b]+"'onblur='zhouxiang(this)' type='text'/></td>";
                        html+="<td><input id='leftAdd"+b+"' name='leftAdd' value='"+leftAdd[b]+"' type='text'/></td>";
                        html+="<td><input id='leftSlj"+b+"' name='leftSlj' value='"+leftSlj[b]+"' type='text'/></td>";
                        html+="<td><input id='leftJd"+b+"' name='leftJd' value='"+leftJd[b]+"' type='text'/></td>";
                        html+="<td><input id='leftFartj"+b+"' name='leftFartj' value='"+leftFartj[b]+"' type='text'/></td>";
                        html+="<td><input id='leftNeartj"+b+"' name='leftNeartj' value='"+leftNeartj[b]+"' type='text'/></td>";
                        html+="</tr>";

                        var numss=numAry[b];
                        var nums111=numAry[b].split(",");
                        var codes=codeAry[b];
                        var names=nameAry[b];
                        alert(numss);
                        alert(nums111+"拆分");
                        // for(var c= 0; c< nums.length; b++){
                        //
                        // }

                    }
                    $("#jpdushu").append(html);




                }
                $("#saleNumber").val(xsNumber);

            }
        });
        layer.full(toIndex);
    }

    //正负+—
    function zhengfu(e) {//正负用onblur事件触发
        var val = parseFloat(e.value);
        if (val > 0) {
            e.value = "+" + val.toFixed(2)
        } else if (val <= 0) {
            e.value = val.toFixed(2)
        }
    };
</script>
</body>
</html>

