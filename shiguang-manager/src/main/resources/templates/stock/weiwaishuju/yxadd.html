<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="keywords" content=""/>
    <meta name="description" content=""/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <title>收据2</title>
    <style type="text/css">
        * {
            padding: 0;
            margin: 0;
            box-sizing: border-box;
            font-size: 14px;
        }

        .main {
            margin: 25px;
        }

        input[type="text"], select, textarea {
            width: 100%;
            line-height: 28px;
            outline: none;
            padding: 2px 10px;
            border: 1px solid #ddd;
        }

        select {
            height: 32px;
        }

        textarea {
            height: auto;
            font-size: 14px;
            resize: none;
        }

        h3 {
            font-size: 18px;
            margin-bottom: 10px;
        }

        table {
            width: 100%;
            text-align: center;
            margin-bottom: 20px;
        }

        table td {
            height: 36px;
            padding: 2px;
            border-bottom: 2px solid #fff;
            border-right: 2px solid #fff;
        }

        .tabA {
            background: #e9f0fa;
        }

        .tabA td:nth-child(odd) {
            background: #cddfeb;
        }

        .Xze, .qingK {
            width: 80px;
            height: 32px;
            margin-left: 10px;
            background: #0091f2;
            color: #fff;
            border: 1px solid #fff;
            outline: none;
            border-radius: 5px;
        }

        .tabB {
            background: #d4f2da;
        }

        .tabB td {
            width: 9.09%;
        }

        .tabB input, .tabC input {
            text-align: center;
        }

        .Add {
            width: 60%;
            height: 32px;
            background: #24c543;
            color: #fff;
            border: 1px solid #fff;
            outline: none;
            border-radius: 5px;
        }

        .tabC {
            background: #cbdde7;
        }

        .qingK {
            margin-left: 0;
        }

        .allpik input {
            width: 150px;
            height: 42px;
            font-size: 16px;
            letter-spacing: 2px;
            background: #0091f2;
            color: #fff;
            border: 2px solid #e9f0fa;
            outline: none;
            border-radius: 5px;
        }

        .tabB1 {
            background: #f6e2ee;
        }

        .tabB1 td {
            width: 12.5%;
        }

        .Add1 {
            width: 60%;
            height: 32px;
            background: #df5eab;
            color: #fff;
            border: 1px solid #fff;
            outline: none;
            border-radius: 5px;
        }

    </style>

</head>
<body>
<form class="form-horizontal m-t" id="signupForm">
    <div class="main">
        <h3>单据信息</h3>
        <input id="eyeStyle" name="eyeStyle" th:value="${eyeStyle}" type="hidden"/>
        <input id="mfrsid" name="mfrsid" th:value="${mfrsid}" type="hidden"/>
        <input id="mfrsname" name="mfrsname" th:value="${mfrsname}" type="hidden"/>
        <table class="tabA" border="0" cellspacing="0" cellpadding="0">
            <tbody>
            <tr>
                <td>销售单号</td>
                <td><input id="number" name="number" th:value="${danjunum}" readonly type="text"/></td>
                <td>单据日期</td>
                <td><input id="danjuDay" name="danjuDay" th:value="${danjuDay}" readonly type="text"/></td>
                <td>所属门店</td>
                <td>
                    <input  th:value="${departmentName}" readonly type="text"/>
                </td>
            </tr>
            <tr>
                <td>制单人</td>
                <td>
                    <input id="zhidanPeople" name="zhidanPeople" th:value="${zhidanPeople}" readonly type="text"/>
                </td>
                <td>镜片型</td>
                <td>
                    <input id="jcStyle" name="jcStyle" th:value="${eyeStyles}" readonly type="text"/>
                </td>
                <td>预计取镜时间</td>
                <td><input readonly id="timetime" name="timetime" type="text"/></td>
            </tr>
            <tr>
                <td>单据类型</td>
                <td>
                    <select id="danjuStyle" name="danjuStyle">
                        <option value="1">外部配镜单</option>
                        <option value="2">回修配镜单</option>
                        <option value="3">报残配镜单</option>
                    </select>
                </td>
                <td>原配镜单</td>
                <td style="text-align:left;">
                    <input id="peijingdan" name="peijingdan" readonly type="text" style="width:80%"/>
                    <input type="button" class="Xze" value="选择" onclick="PeiJing()"/>
                </td>
                <td>委外类型</td>
                <td>
                    <select id="weiwaiStyle" name="weiwaiStyle">
                        <option value="委外订单">委外订单</option>
                        <option value="委外加工">委外加工</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>备注</td>
                <td colspan="5"><textarea name="beizhu" id="beizhu" cols="30" rows="2"></textarea></td>
            </tr>
            </tbody>
        </table>

        <h3>度数录入</h3>
        <table id="jpdushu" class="tabB1" border="0" cellspacing="0" cellpadding="0"></table>
        <table id="tab2"  class="tabB1" border="0" cellspacing="0" cellpadding="0">
            <tr>
                <td></td>
                <td>球镜</td>
                <td>柱镜</td>
                <td>轴向</td>
                <td>曲率</td>
                <td>直径</td>
                <!--				<td>选择</td>-->
            </tr>
            <tr>
                <td>OD</td>
                <td><input id="rightsphyx" name="rightsphyx" onblur="zhengfu(this)" onkeydown="xiaoshu(this)"
                           type="text"/></td>
                <td><input id="rightcylyx" name="rightcylyx" onblur="zhengfu(this)" onkeydown="xiaoshu(this)"
                           type="text"/></td>
                <td><input id="rightzxyx" name="rightzxyx" onblur="zhouxiang(this)" type="text"/></td>
                <td><input id="rightqulv" name="rightqulv" type="text"/></td>
                <td><input id="rightzj" name="rightzj" type="text"/></td>
                <!--				<td><input type="button" class="Add1" value="单品添加商品" /></td>-->
            </tr>
            <tr>
                <td>OS</td>
                <td><input id="leftsphyx" name="leftsphyx" onblur="zhengfu(this)" onkeydown="xiaoshu(this)"
                           type="text"/></td>
                <td><input id="leftcylyx" name="leftcylyx" onblur="zhengfu(this)" onkeydown="xiaoshu(this)"
                           type="text"/></td>
                <td><input id="leftzxyx" name="leftzxyx" onblur="zhouxiang(this)" type="text"/></td>
                <td><input id="leftqulv" name="leftqulv" type="text"/></td>
                <td><input id="leftzj" name="leftzj" type="text"/></td>
                <!--				<td><input type="button" class="Add1" value="单品添加商品" /></td>-->
            </tr>
        </table>
        <h3>商品列表</h3>
        <table id="jp" class="tabC" border="0" cellspacing="0" cellpadding="0"></table>
        <table id="tab4"  class="tabC" border="0" cellspacing="0" cellpadding="0">
            <tr>
                <td width="250">商品代码</td>
                <td width="250">商品名称</td>
                <td>镜片型</td>
                <td>球镜</td>
                <td>柱镜</td>
                <td>轴向</td>
                <td>曲率</td>
                <td>直径</td>
                <td>数量</td>
                <td width="300">特殊加工要求</td>
                <!--				<td width="100">操作</td>-->
            </tr>
            <tr>
                <td><input type="text"/></td>
                <td><input type="text"/></td>
                <td><input type="text"/></td>
                <td><input type="text"/></td>
                <td><input type="text"/></td>
                <td><input type="text"/></td>
                <td><input type="text"/></td>
                <td><input type="text"/></td>
                <td><input type="text"/></td>
                <td><input type="text"/></td>
            </tr>
            <tr>
                <td><input type="text"/></td>
                <td><input type="text"/></td>
                <td><input type="text"/></td>
                <td><input type="text"/></td>
                <td><input type="text"/></td>
                <td><input type="text"/></td>
                <td><input type="text"/></td>
                <td><input type="text"/></td>
                <td><input type="text"/></td>
                <td><input type="text"/></td>
            </tr>
        </table>



        <div class="allpik"><input type="button" value="保存" onclick="save()"/></div>
    </div>
</form>
<div th:include="include::footer"></div>
<script type="text/javascript" src="/js/appjs/stock/weiwaishuju/jpadd.js"></script>
<script type="text/javascript">
    //日期
    laydate.render({
        elem: '#timetime',
        type: 'date'
    });


    var numAry = new Array();
    var codeAry = new Array();
    var nameAry = new Array();
    var leftRightArry = new Array();
    var storeDescribeArry = new Array();
    var storeCountArry = new Array();
    var classtypeArry = new Array();
    var processAskArry = new Array();
    var hyNameArry = new Array();
    var hyNumberArry = new Array();
    var phoneArry = new Array();
    var departnameArry = new Array();

    function PeiJing() {
        $("#tab2").remove();
        $("#tab4").remove();
        var html = "";
        var bhtml = "";
        var xsNumber="";
        var rightsphs="";
        var rightcyls="";
        var rightzxs="";
        var rightJds="";
        var rightqulvs="";
        var rightzjs="";


        var leftsphs="";
        var leftcyls="";
        var leftzxs="";
        var leftJds="";
        var leftqulvs="";
        var leftzjs="";





        var eyeStyle = $('#eyeStyle').val();
        var mfrsid = $('#mfrsid').val();
        var mfrsname = $('#mfrsname').val();
        var toIndex = layer.open({
            type: 2,
            title: '原配镜单',
            maxmin: true,
            shadeClose: false, // 点击遮罩关闭层
            area: ['800px', '520px'],
            content: "/stock/weiwai/PeiJing/" + eyeStyle+ "/" +  mfrsid + "/" +  mfrsname,// iframe的url
            cancel: function (index, layero) {
                var rows = $(layero).find("iframe")[0].contentWindow.batchSelect();
                for (var i = 0; i < rows.length; i++) {
                    xsNumber += rows[i].saleNumber + ',';
                    rightsphs += rows[i].rightsph + ',';
                    rightcyls += rows[i].rightcyl + ',';
                    rightzxs += rows[i].rightzx + ',';
                    rightJds += rows[i].rightJd + ',';
                    rightqulvs += rows[i].rightqulv + ',';
                    rightzjs += rows[i].rightzj + ',';

                    leftsphs += rows[i].leftsph + ',';
                    leftcyls += rows[i].leftcyl + ',';
                    leftzxs += rows[i].leftzx + ',';
                    leftJds += rows[i].leftJd + ',';
                    leftqulvs += rows[i].leftqulv + ',';
                    leftzjs += rows[i].leftzj + ',';


                    numAry[i]=rows[i].goodsNum;
                    codeAry[i]=rows[i].goodsCode;
                    nameAry[i]=rows[i].storeName;
                    leftRightArry[i]=rows[i].leftRight;
                    storeDescribeArry[i]=rows[i].storeDescribe;
                    storeCountArry[i]=rows[i].storeCount;
                    classtypeArry[i]=rows[i].classtype;
                    processAskArry[i]=rows[i].processAsk;//镜片区分
                    hyNameArry[i]=rows[i].name;//姓名 rows[i].name
                    hyNumberArry[i]=rows[i].memberNumber;//卡号rows[i].memberNumber
                    phoneArry[i]=rows[i].phone1;//电话rows[i].phone1
                    departnameArry[i]=rows[i].mirorAddress;//销售门店


                }
                if (eyeStyle == 4) {
                    var allLength=xsNumber.split(",");//单据

                    var rightsph=rightsphs.split(",");
                    var rightcyl=rightcyls.split(",");
                    var rightzx=rightzxs.split(",");
                    var rightJd=rightJds.split(",");
                    var rightql=rightqulvs.split(",");
                    var rightzj=rightzjs.split(",");




                    var leftsph=leftsphs.split(",");
                    var leftcyl=leftcyls.split(",");
                    var leftzx=leftzxs.split(",");

                    var leftJd=leftJds.split(",");
                    var leftql=leftqulvs.split(",");
                    var leftzj=leftzjs.split(",");



                    for (var b = 0; b< allLength.length-1; b++) {
                        html += "<tr>";
                        html+="<td></td>";
                        html+="<td>球镜</td>";
                        html+="<td>柱镜</td>";
                        html+="<td>轴向</td>";
                        html+="<td>曲率</td>";
                        html+="<td>直径</td>";
                        html+="</tr>";
                        html+="<tr>";
                        html+="<td>OD</td>";

                        html+="<td><input id='rightsphyx' value='"+rightsph[b]+"' onblur='zhengfu(this)' onkeydown='xiaoshu(this)' type='text'/></td>";
                        html+="<td><input id='rightcylyx'  value='"+rightcyl[b]+"' onblur='zhengfu(this)' onkeydown='xiaoshu(this)' type='text'/></td>";
                        html+="<td><input id='rightzxyx'  value='"+rightzx[b]+"' onblur='zhouxiang(this)' type='text'/></td>";
                        html+="<td><input id='rightqulv'  value='"+rightql[b]+"' type='text'/></td>";
                        html+="<td><input id='rightzj'  value='"+rightzj[b]+"'  type='text'/></td>";
                        html+="</tr>";
                        html+="<tr>";
                        html+="<td>OS</td>";
                        html+="<td><input id='leftsphyx'   value='"+leftsph[b]+"' onblur='zhengfu(this)' onkeydown='xiaoshu(this)' type='text'/></td>";
                        html+="<td><input id='leftcylyx'   value='"+leftcyl[b]+"' onblur='zhengfu(this)' onkeydown='xiaoshu(this)' type='text'/></td>";
                        html+="<td><input id='leftzxyx'  value='"+leftzx[b]+"'onblur='zhouxiang(this)' type='text'/></td>";
                        html+="<td><input id='leftqulv'  value='"+leftql[b]+"' type='text'/></td>";
                        html+="<td><input id='leftzj'  value='"+leftzj[b]+"'  type='text'/></td>";
                        html+="</tr>";


                        var goodsNums=numAry[b];
                        var goodsCodes=codeAry[b];
                        var goodsNames=nameAry[b];
                        var goodsLeftRights=leftRightArry[b];
                        var goodsDescribes=storeDescribeArry[b];
                        var goodsCounts=storeCountArry[b];
                        var goodsClasstypes=classtypeArry[b];


                        // alert(processAskArry);
                        var processAsks= processAskArry[b];//加工要求
                        var hyNames= hyNameArry[b];
                        var hyNumbers= hyNumberArry[b];
                        var phones= phoneArry[b];
                        var departnames= departnameArry[b];


                        var goodNums=goodsNums.split(",");//代码
                        var goodCodes=goodsCodes.split(",");//条码
                        var leftRights=goodsLeftRights.split(",");//左右
                        var goodNames=goodsNames.split(",");//名称
                        var gooodDescribes = goodsDescribes.split(",");//描述
                        var goodCounts = goodsCounts.split(",");//数量
                        var goodClasstypes = goodsClasstypes.split(",");//定做还是成品
                        var processAsk = processAsks;//加工要求
                        var yaoqiu=processAsk.replaceAll(',', '!');
                        var hyName = hyNames.split(",");
                        var hyNumber = hyNumbers.split(",");
                        var phone = phones.split(",");
                        var departname = departnames.split(",");

                        bhtml += "<tr>";
                        bhtml += "<td width='250'>商品代码</td>";
                        bhtml += "<td width='250'>商品名称</td>";
                        bhtml += "<td>镜片型</td>";
                        bhtml += "<td>球镜</td>";
                        bhtml += "<td>柱镜</td>";
                        bhtml += "<td>轴向</td>";
                        bhtml += "<td>曲率</td>";
                        bhtml += "<td>直径</td>";
                        bhtml += "<td>数量</td>";
                        bhtml += "<td width='300'>加工要求</td>";
                        bhtml += "</tr>";

                        for(var c= 0; c<goodNums.length; c++) {
                            // alert(goodNums[c]+"？代码");
                            // alert(goodCodes[c]+"？条码");
                            // alert(leftRights[c]+"？左右");
                            // alert(goodNames[c]+"？名称");
                            // alert(gooodDescribes[c]+"？描述");
                            // alert(goodCounts[c]+"？数量");
                            // alert(goodClasstypes[c]+"？成品定制");
                            // alert(processAsk);


                            if (gooodDescribes[c] == "隐形") {
                                if (leftRights[c] == "右") {
                                    var sph = rightsph[b];
                                    var cyl = rightcyl[b];
                                    var zx = rightzx[b];

                                    var jd = rightJd[b];

                                    var ql = rightql[b];
                                    var zj = rightzj[b];



                                    if (goodClasstypes[c] == "2") {
                                        bhtml += "<tr>";
                                        bhtml += "<td><input id='numyx' name='numyx'  value='" + goodNums[c] + "' type='text' /></td>";
                                        bhtml += "<td><input id='nameyx' name='nameyx'  value='" + goodNames[c] + "' type='text' /></td>";
                                        bhtml += "<td><input id='leftRightYx' name='leftRightYx'  value='" + leftRights[c] + "' type='text' /></td>";
                                        bhtml += "<td><input id='sphyx' name='sphyx'  value='" + sph + "' type='text' /></td>";
                                        bhtml += "<td><input id='cylyx' name='cylyx' value='" + cyl + "' type='text' /></td>";
                                        bhtml += "<td><input id='zxyx'  name='zxyx' value='" + zx + "' type='text' /></td>";
                                        bhtml += "<td><input id='qulv'  name='qulv' value='" + ql + "' type='text' /></td>";
                                        bhtml += "<td><input id='zj'  name='zj' value='" + zj + "' type='text' /></td>";

                                        bhtml += "<td style='display: none'><input id='jdyx' name='jdyx' value='" + jd + "' type='text' /></td>";


                                        bhtml += "<td><input id='countyx' name='countyx'  value='" + goodCounts[c] + "' type='text'/></td>";
                                        bhtml += "<td><input id='yaoqiuyx' name='yaoqiuyx' value='" + yaoqiu  + "' type='text' /></td>";

                                        bhtml += "<td style='display: none'><input id='codeyx' name='codeyx' value='" + goodCodes[c] + "' type='text' /></td>";
                                        bhtml += "<td style='display: none'><input id='saleNumber' name='saleNumber' value='" + allLength[b] + "' type='text'/></td>";
                                        bhtml += "<td style='display: none'><input id='gkname' name='gkname' value='" + hyName[0] + "' type='text'/></td>";
                                        bhtml += "<td style='display: none'><input id='hyknum' name='hyknum' value='" + hyNumber[0] + "' type='text'/></td>";
                                        bhtml += "<td style='display: none'><input id='phone' name='phone' value='" + phone[0] + "' type='text'/></td>";
                                        bhtml += "<td style='display: none'><input id='departname' name='departname' value='" + departname[0] + "' type='text'/></td>";
                                        bhtml += "</tr>";
                                    }
                                } else if (leftRights[c] == "左") {
                                    var sph = leftsph[b];
                                    var cyl = leftcyl[b];
                                    var zx = leftzx[b];

                                    var jd = leftJd[b];


                                    var ql = leftql[b];
                                    var zj = leftzj[b];
                                    if (goodClasstypes[c] == "2") {
                                        bhtml += "<tr>";
                                        bhtml += "<td><input id='numyx' name='numyx'  value='" + goodNums[c] + "' type='text' /></td>";
                                        bhtml += "<td><input id='nameyx' name='nameyx'  value='" + goodNames[c] + "' type='text' /></td>";
                                        bhtml += "<td><input id='leftRightYx' name='leftRightYx'  value='" + leftRights[c] + "' type='text' /></td>";
                                        bhtml += "<td><input id='sphyx' name='sphyx'  value='" + sph + "' type='text' /></td>";
                                        bhtml += "<td><input id='cylyx' name='cylyx' value='" + cyl + "' type='text' /></td>";
                                        bhtml += "<td><input id='zxyx'  name='zxyx' value='" + zx + "' type='text' /></td>";
                                        bhtml += "<td><input id='qulv'  name='qulv' value='" + ql + "' type='text' /></td>";
                                        bhtml += "<td><input id='zj'  name='zj' value='" + zj + "' type='text' /></td>";

                                        bhtml += "<td style='display: none'><input id='jdyx' name='jdyx' value='" + jd + "' type='text' /></td>";


                                        bhtml += "<td><input id='countyx' name='countyx'  value='" + goodCounts[c] + "' type='text'/></td>";
                                        bhtml += "<td><input id='yaoqiuyx' name='yaoqiuyx' value='" + yaoqiu  + "' type='text' /></td>";

                                        bhtml += "<td style='display: none'><input id='codeyx' name='codeyx' value='" + goodCodes[c] + "' type='text' /></td>";
                                        bhtml += "<td style='display: none'><input id='saleNumber' name='saleNumber' value='" + allLength[b] + "' type='text'/></td>";
                                        bhtml += "<td style='display: none'><input id='gkname' name='gkname' value='" + hyName[0] + "' type='text'/></td>";
                                        bhtml += "<td style='display: none'><input id='hyknum' name='hyknum' value='" + hyNumber[0] + "' type='text'/></td>";
                                        bhtml += "<td style='display: none'><input id='phone' name='phone' value='" + phone[0] + "' type='text'/></td>";
                                        bhtml += "<td style='display: none'><input id='departname' name='departname' value='" + departname[0] + "' type='text'/></td>";
                                        bhtml += "</tr>";
                                    }
                                }


                            }
                        }
                    }
                    $("#jp").append(bhtml);
                    $("#jpdushu").append(html);
                }
                var peijiang=$("#peijingdan").val();
                $("#peijingdan").val(peijiang+xsNumber);

            }
        });
        layer.full(toIndex);
    }

    //正负+—
    function zhengfu(e) {//正负用onblur事件触发
        var val = parseFloat(e.value);
        if (val > 0) {
            e.value = "+" + val.toFixed(2)
        } else if (val <= 0) {
            e.value = val.toFixed(2)
        }
    };
</script>
</body>
</html>

