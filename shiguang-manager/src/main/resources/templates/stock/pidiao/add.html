<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="keywords" content="" />
	<meta name="description" content="" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<title>商品批调管理</title>
	<link rel="stylesheet" href="/css/css.css" type="text/css">
	<script type="text/javascript" src="/js/jquery-1.11.3.min.js"></script>
	<script type="text/javascript" src="/js/jquery.SuperSlide.2.1.1.js"></script>
</head>
<body>
<!--单据信息-->
<div class="m40 tabS msgBox">
	<h3>单据信息</h3>
	<table border="0" cellspacing="0" cellpadding="0">
		<tr>
			<td>批调单号：</td>
			<td>
				<input id="pidiaoNumber" name="pidiaoNumber" th:value="${pidiaoNum}" style="background-color: #e4e4e4" readonly type="text">
			</td>
			<td>关联单号：</td>
			<td>
				<input id="guanlianNumber" name="guanlianNumber" type="text"/>
			</td>
			<td>发出部门：</td>
			<td>
				<select id="outDepartment" name="outDepartment" style="width:50%" onchange="outposion()">
					<option></option>
					<option th:each="ls:${departmentDOList}"
							th:text="${ls.departName}"
							th:value="${ls.departName}"
					></option>
				</select>
			</td>
		</tr>
		<tr>
			<td>发出仓位：</td>
			<td>
				<select  id="outPosition" name="outPosition" style="width:50%" class="outcw"></select>
			</td>
			<td>接收公司：</td>
			<td>
				<select id="inCompany" name="inCompany" style="width:50%" onchange="indepartment()">
					<option></option>
					<option th:each="ls:${companyList}"
							th:text="${ls.name}"
							th:value="${ls.name}"
					></option>
				</select>
			</td>
			<td>接收部门：</td>
			<td>
				<select id="inDepartment" name="inDepartment" style="width:50%" class="ings" onchange="inposion()"></select>
			</td>

		</tr>
		<tr>
			<td>接收仓位：</td>
			<td>
				<select id="inPosition" name="inPosition" style="width:50%" class="incw"></select>
			</td>
			<td>制单人：</td>
			<td>
				<input id="zhidanPeople" name="zhidanPeople" type="text" />
			</td>
			<td>单据日期：</td>
			<td>
				<input id="danjuDay" name="danjuDay" type="text"/>
			</td>
		</tr>
		<tr>
			<td>备注：</td>
			<td colspan="5"><textarea id="beizhu" name="beizhu" rows="3"></textarea></td>
		</tr>
		</tbody>
	</table>

	<div class="HH_btns">
		<div class="Xbtn">
			<input type="button" value="单品添加商品" onclick="choiceGoods()" />
			<!--<input type="button" value="已核销订单添加商品" />-->
			<!--<input type="button" value="二维表添加商品" />-->
			<!--<input class="HgreenBG" type="button" value="打印条码" />-->
		</div>
		<div class="Cbtn buyBtns">
			<input type="button" class="H_bc" value="保存" onclick="baocun()" />
			<!--<input type="checkbox" id="Hbc" /> <label for="Hbc">保存并审核</label>-->
		</div>
	</div>

</div>
<!--商品信息-->
<div class="m40 tabS SPmsg">
	<h3>商品信息</h3>
	<table border="0" cellspacing="0" cellpadding="0" class="buyBtns">
		<tbody>
		<tr class="thead">
			<!--<td>全选 <input type="checkbox" /></td>-->
			<!--<td></td>-->
			<td>商品代码</td>
			<td>商品名称</td>
			<td>型号</td>
			<td>需求数量</td>
			<td>可调用数量</td>
			<td>批调数量</td>
			<td>商品条码</td>
			<td>效期</td>
			<td>批号</td>
			<td>注册证号</td>
			<td>生产日期</td>
		</tr>
		<tr class="liebiao">
			<td colspan="5"></td>
			<td>合计：</td>
			<td>45684</td>
		</tr>
		<tr>
			<td><input type="checkbox" /></td>
			<td>123569875425</td>
			<td>名称名称每次</td>
			<td>SD90</td>
			<td>148</td>
			<td>148</td>
			<td>148</td>
			<td>148</td>
			<td>148</td>
			<td>148</td>
			<td>2020-12-25</td>
			<td>569999</td>
		</tr>
		</tbody>
	</table>
	<div class="Cbtn buyBtns">
		<input type="button" class="H_bc" value="保存" />
		<!--<input type="checkbox" id="HHbc" /> <label for="HHbc">保存并审核</label>-->
	</div>
</div>
<div th:include="include::footer"></div>
<script type="text/javascript" src="/js/appjs/stock/pidiao/add.js"></script>
<script type="text/javascript" src="/js/appjs/stock/pidiao/pidiao.js"></script>
<script type="text/javascript">
function outposion() {
    var outDepartment = $("#outDepartment option:selected").text();
    $(".outcw").empty("");
    // $(".outcw").append("<option value=''></option>");
    $.ajax({
        url: '/stock/pidiao/outposion',
        type: 'post',
        dataType: "json",
        data: {
            'outDepartment': outDepartment
        },
        success: function (datajson) {
            $(datajson).each(function (key) {  //循环读取后台传来的Json数据
                var id = datajson[key].positionId;   //角色id
                var roleName = datajson[key].positionName; //角色名称
				// alert(id+roleName);
                //调用自定义方法
                $(".outcw").append("<option value='" + id + "'>" + roleName + "</option>");
            });
        }
	})
}
function indepartment() {
    var inCompany = $("#inCompany option:selected").text();
    $(".ings").empty("");
    $(".ings").append("<option value=''></option>");
    $.ajax({
        url: '/stock/pidiao/indepartment',
        type: 'post',
        dataType: "json",
        data: {
            'inCompany': inCompany
        },
        success: function (datajson) {
            $(datajson).each(function (key) {  //循环读取后台传来的Json数据
                var id = datajson[key].id;   //角色id
                var roleName = datajson[key].departName; //角色名称
				alert(id+roleName);
                //调用自定义方法
                $(".ings").append("<option value='" + id + "'>" + roleName + "</option>");
            });
        }
	})
}
function inposion() {
    var inDepartment = $("#inDepartment option:selected").text();
    $(".incw").empty("");
    // $(".incw").append("<option value=''></option>");
    $.ajax({
        url: '/stock/pidiao/inposion',
        type: 'post',
        dataType: "json",
        data: {
            'inDepartment': inDepartment
        },
        success: function (datajson) {
            $(datajson).each(function (key) {  //循环读取后台传来的Json数据
                var id = datajson[key].positionId;   //角色id
                var roleName = datajson[key].positionName; //角色名称
                // alert(id+roleName);
                //调用自定义方法
                $(".incw").append("<option value='" + id + "'>" + roleName + "</option>");
            });
        }
    })
}
    // <!--单品添加商品-->
    function choiceGoods() {
        var outDepartment = $("#outDepartment option:selected").text();
        var outPosition = $("#outPosition option:selected").text();
        var inCompany = $("#inCompany option:selected").text();
        var inDepartment = $("#inDepartment option:selected").text();
        if (outDepartment == "") {
            layer.alert("请选择发出部门！");
            // return this;
        } else if (outPosition == "") {
            layer.alert("请选择发出仓位！");
            // return this;
        }else if (inCompany == ""){
            layer.alert("请选择接收公司！");
		} else if (inDepartment == ""){
            layer.alert("请选择接收部门！");
		} else {
            $(".val").remove();
            var toIndex = layer.open({
                type: 2,
                title: '库存查询',
                maxmin: true,
                shadeClose: false, // 点击遮罩关闭层
                area: ['800px', '520px'],
                content: "/stock/pidiao/selextkc/",// iframe的url
                cancel: function (index, layero) {
                    var rows = window[layero.find('iframe')[0]['name']].showCol();
                    // layer.alert(JSON.stringify(rows))
                    for (var i = 0; i < rows.length; i++) {
                        $(".liebiao").after("<tr class='val'> " +
							// "<td><input name='one'  type=\"checkbox\"/></td>\n" +
                            "<td name='goodsNum'>" + xml[i].goodsNum + "</td>\n" +
                            "<td name='goodsName'>" + xml[i].goodsName + "</td>\n" +
                            "<td name='producFactory'>" + xml[i].producFactory + "</td>\n" +
                            "<td name='unitname'>" + xml[i].unitname + "</td>\n" +
                            "<td name='retailPrice'>" + xml[i].retailPrice + "</td>\n" +
                            "<td name='taxPrice'>" + xml[i].taxPrice + "</td>\n" +
                            "<td name='tradePrice'style='display: none'>" + xml[i].tradePrice + "</td>\n" +
                            "<td name='transferPrice'style='display: none'>" + xml[i].transferPrice + "</td>\n" +
                            "<td name='producCode'style='display: none'>" + xml[i].producCode + "</td>\n" +
                            "<td name='brandname' style='display: none'>" + xml[i].brandname + "</td></tr>>");//页面每个数量
                    }
                }
            });
            layer.full(toIndex)
		}
    }
</script>
</body>
</html>
