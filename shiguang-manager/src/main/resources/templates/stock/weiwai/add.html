<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="keywords" content=""/>
    <meta name="description" content=""/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <title>委外订单新增</title>
    <link rel="stylesheet" href="/css/css.css" type="text/css">
    <script type="text/javascript" src="/js/jquery-1.11.3.min.js"></script>
    <script type="text/javascript" src="/js/jquery.SuperSlide.2.1.1.js"></script>
</head>
<body>
<!--查询条件-->

<form class="form-horizontal m-t" id="signupForm">
    <div class="m40 tabS msgBox">
        <h3>单据信息</h3>
        <table border="0" cellspacing="0" cellpadding="0">
            <tr>
                <td>单据编号：</td>
                <td><input id="danjuNumber" name="danjuNumber" th:value="${danjuNumber}" type="text"></td>
                <td>单据日期：</td>
                <td><input id="danjuDay" name="danjuDay" th:value="${danjuDay}" type="text"></td>
                <td>订单类型：</td>
                <td>
                    <select id="eyeStyle" name="eyeStyle" style="width:48%" onchange="show()">
                        <option></option>
                        <option value="3">框镜订做</option>
                        <option value="4">隐形订做</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>制单人：</td>
                <td>
                    <input id="zhidanPeople" name="zhidanPeople" th:value="${zhidanPeople}" type="text"/>
                </td>
                <td>制造商：</td>
                <td>
                    <input id="mfrsid" name="mfrsid" type="hidden"/>
                    <input id="mfrsName" name="mfrsname" type="text" readonly/>
                    <input type="button" class="XZ-btn" value="选择" onclick="choiceMfrs()"/>
                </td>
                <td>收入仓位：</td>
                <td>
                    <input id="positionId" name="positionId" th:value="${positionId}" type="hidden"/>
                    <input id="positionName" name="positionName" th:value="${positionName}" type="text"/>
                </td>

            </tr>
            <tr>
                <td>收货联系人：</td>
                <td>
                    <input id="shouhuoPeople" name="shouhuoPeople" th:value="${zhidanPeople}" type="text"/>
                </td>
                <td>收货联系电话：</td>
                <td>
                    <input id="shouhuoPhone" name="shouhuoPhone" th:value="${departTel}" type="text"/>
                </td>
                <td>收货地址：</td>
                <td>
                    <input id="shouhuoAddress" name="shouhuoAddress" th:value="${departAddress}" type="text"/>
                </td>
            </tr>
            <tr>
                <td>备注：</td>
                <td colspan="5"><textarea id="beizhu" name="beizhu" rows="3"></textarea></td>
            </tr>

        </table>
        <input id="gkname" name="gkname" type="hidden"/>
        <input id="hyknum" name="hyknum" type="hidden"/>
        <input id="phone" name="phone" type="hidden"/>
        <input id="salenumbery" name="salenumbery" type="hidden"/>
        <!--保存/清空-->
        <div class="BQ-btn">
            <!--<input type="button" value="内部配镜单" />-->
            <input type="button" class="empty" value="外部配镜单" onclick="waibu()"/>
            <input id="status" name="status" value="1" type="hidden"/>
            <input id="username" name="username" value="未收货" type="hidden"/>
            <input type="button" class="H_bc" value="保存并审核" onclick="save()"/>
        </div>
    </div>
    <!--商品信息-->
    <div class="m40 tabS msgBoxDD">
        <table border="0" cellspacing="0" cellpadding="0" class="buyBtns">
            <tbody>
            <tr id="tab1" style="display:none">
                <td style="width: 100vw;">
                    <table>
                        <tr class="thead">
                            <!--<td>多选</td>-->
                            <td>配镜单号</td>
                            <td>取镜时间</td>
                            <td>商品名称</td>
                            <td>委外方式</td>
                            <td>镜片类型</td>
                            <td>数量</td>
                            <td>球镜</td>
                            <td>柱镜</td>
                            <td>轴向</td>
                            <td>下加</td>
                            <td>棱镜</td>
                            <td>直径</td>
                            <td>加工要求</td>
                        </tr>
                        <tr style="font-weight:bold;font-size: 15px;" class="heji1" id="heji1"></tr>
                    </table>
                </td>
            </tr>
            <tr id="tab2" style="display:none;">
                <td style="width: 100vw;">
                    <table>
                        <tr class="thead">
                            <!--<td>多选</td>-->
                            <td>配镜单号</td>
                            <td>取镜时间</td>
                            <td>商品名称</td>
                            <td>委外方式</td>
                            <td>镜片类型</td>
                            <td>数量</td>
                            <td>球镜</td>
                            <td>柱镜</td>
                            <td>轴向</td>
                            <td>基底</td>
                            <td>曲率</td>
                            <td>直径</td>
                            <td>加工要求</td>
                        </tr>
                        <tr style="font-weight:bold;font-size: 15px;" class="heji2"></tr>
                    </table>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</form>

<div th:include="include::footer"></div>
<script type="text/javascript" src="/js/appjs/stock/weiwai/add.js"></script>
<script type="text/javascript">

    $().ready(function () {
        var number = window.localStorage.getItem("number");//销售单号
        var eyeStyle = window.localStorage.getItem("eyeStyle");//定做类型
        // alert(eyeStyle)
        var mfrsid = window.localStorage.getItem("mfrsid");//制造商id
        // alert(mfrsid)
        $('#mfrsid').val(mfrsid);
        var mfrsname = window.localStorage.getItem("mfrsname");//制造商名称
        // alert(mfrsname)
        $('#mfrsName').val(mfrsname);


        var gkname = window.localStorage.getItem("gkname");
        // alert(gkname)
        $('#gkname').val(gkname);

        var hyknum = window.localStorage.getItem("hyknum");
        $('#hyknum').val(hyknum);

        var phone = window.localStorage.getItem("phone");
        $('#phone').val(phone);

        var salenumbery = window.localStorage.getItem("saleNumber");
        $('#salenumbery').val(salenumbery);

        if (eyeStyle == 3) {
            $("#eyeStyle").find("[value='" + eyeStyle + "']").attr("selected", true);
            $(".val2").remove();
            tab1.style = "display: block";
            tab2.style = "display: none";
            if (number != null) {
                $.ajax({
                    url: '/stock/weiwaishuju/getWeiwaiShuju',
                    type: 'post',
                    dataType: "json",
                    data: {
                        'number': number,
                    },
                    success: function (xml) {
                        // alert(JSON.stringify(xml));

                        for (var i = 0; i < xml.length; i++) {
                            var str = xml[i].name;
                            var name = str.split(",");
                            var num = xml[i].num.split(",");
                            var code = xml[i].code.split(",");
                            var leftRight = xml[i].leftRight.split(",");
                            var count = xml[i].count.split(",");
                            var yaoqiu = xml[i].yaoqiu.split(",");
                            var sph="";
                            var cyl="";
                            var axial="";
                            var lightbelow="";
                            var lengjing="";
                            var diameter="";
                            for (var a = 0; a < name.length; a++) {
                                if (leftRight[a]=="右"){
                                    sph=xml[i].rightsph;
                                    cyl=xml[i].rightcyl;
                                    axial= xml[i].rightzx;
                                    lightbelow= xml[i].rightAdd;
                                    lengjing=  xml[i].rightSlj ;
                                    diameter=  xml[i].rightzj ;
                                }else if (leftRight[a]=="左") {
                                    sph=xml[i].leftsph;
                                    cyl=xml[i].leftcyl;
                                    axial= xml[i].leftzx;
                                    lightbelow= xml[i].leftAdd;
                                    lengjing=  xml[i].leftSlj ;
                                    diameter=  xml[i].leftzj ;
                                }
                                $(".heji1").before("<tr class='val1'>" +
                                    "<td >" + xml[i].number + "</td>\n" +//0
                                    "<input name='saleNumber' type='hidden' value='" + xml[i].number + "'>\n" +//1
                                    "<td>" + xml[i].timetime + "</td>\n" +//2
                                    "<input name='mirrorTime' type='hidden' value='" + xml[i].timetime + "'>\n" +//3
                                    "<td>" + name[a] + "</td>\n" +//2
                                    "<input name='goodsName' type='hidden' value='" + name[a] + "'>\n" +//3
                                    "<td>" + xml[i].weiwaiStyle + "</td>\n" +//2
                                    "<input name='style' type='hidden' value='" + xml[i].weiwaiStyle + "'>\n" +//3
                                    "<td>" + leftRight[a] + "</td>\n" +//2
                                    "<input name='rl' type='hidden' value='" + leftRight[a] + "'>\n" +//3
                                    "<td>" + count [a] + "</td>\n" +//数量
                                    "<input name='count' type='hidden' value='" + count [a] + "'>\n" +
                                    "<td>" + sph + "</td>\n" +//球镜
                                    "<input name='sph' type='hidden' value='" + sph + "'>\n" +//3
                                    "<td>" + cyl + "</td>\n" +//zhu镜
                                    "<input name='cyl' type='hidden' value='" + cyl+ "'>\n" +
                                    "<td>" + axial + "</td>\n" +//zhu镜
                                    "<input name='axial' type='hidden' value='" + axial+ "'>\n" +
                                    "<td>" + lightbelow+ "</td>\n" +//zhu镜
                                    "<input name='lightbelow' type='hidden' value='" + lightbelow + "'>\n" +
                                    "<td>" + lengjing + "</td>\n" +//zhu镜
                                    "<input name='lengjing' type='hidden' value='" +lengjing+ "'>\n" +
                                    "<td>" + diameter + "</td>\n" +//zhu镜
                                    "<input name='diameter' type='hidden' value='" + diameter + "'>\n" +
                                    "<td>" + yaoqiu[a] + "</td>\n" +//zhu镜
                                    "<input id='' name='yaoqiu' type='hidden' value='" + yaoqiu[a] + "'>\n" +
                                    "<td style='display:none;'>" + num[a] + "</td>\n" +
                                    "<input name='num' type='hidden' value='" + num[a] + "'>\n" +
                                    "<input name='code' type='hidden' value='" + code[a] + "'>\n" +
                                    "</tr>"
                                );//页面每个数量
                            }
                        }
                    }
                })
            }
        } else if (eyeStyle == 4) {
            $("#eyeStyle").find("[value='" + eyeStyle + "']").attr("selected", true);
            $(".val1").remove();
            tab1.style = "display: none";
            tab2.style = "display: block";
            if (number != null) {
                $.ajax({
                    url: '/stock/weiwaishuju/getWeiwaiShuju',
                    type: 'post',
                    dataType: "json",
                    data: {
                        'number': number,
                    },
                    success: function (xml) {
                        for (var i = 0; i < xml.length; i++) {
							var str = xml[i].nameyx;
							var nameyx = str.split(",");
							var numyx = xml[i].numyx.split(",");
							var codeyx = xml[i].codeyx.split(",");
							var leftRightYx = xml[i].leftRightYx.split(",");
							var countyx = xml[i].countyx.split(",");
							var yaoqiuyx = xml[i].yaoqiuyx.split(",");
							for (var a = 0; a < nameyx.length; a++) {
								$(".heji2").before("<tr class='val1'>" +
										"<td >" + xml[i].number + "</td>\n" +//0
										"<input name='saleNumber' type='hidden' value='" + xml[i].number + "'>\n" +//1
										"<td>" + xml[i].timetime + "</td>\n" +//2
										"<input name='mirrorTime' type='hidden' value='" + xml[i].timetime + "'>\n" +//3
										"<td>" + nameyx[a] + "</td>\n" +//2
										"<input name='goodsName' type='hidden' value='" + nameyx[a] + "'>\n" +//3
										"<td>" + xml[i].weiwaiStyle + "</td>\n" +//2
										"<input name='style' type='hidden' value='" + xml[i].weiwaiStyle + "'>\n" +//3
										"<td>" + leftRightYx[a] + "</td>\n" +//2
										"<input name='rl' type='hidden' value='" + leftRightYx[a] + "'>\n" +//3
										"<td>" + countyx[a] + "</td>\n" +//数量
										"<input name='count' type='hidden' value='" + countyx[a]+ "'>\n" +
										"<td>" + xml[i].rightsphyx + "</td>\n" +//球镜
										"<input name='sph' type='hidden' value='" + xml[i].rightsphyx + "'>\n" +//3
										"<td>" + xml[i].rightcylyx + "</td>\n" +//zhu镜
										"<input name='cyl' type='hidden' value='" + xml[i].rightcylyx + "'>\n" +
										"<td>" + xml[i].rightzxyx + "</td>\n" +//zhu镜
										"<input name='axial' type='hidden' value='" + xml[i].rightzxyx + "'>\n" +
										"<td>" + xml[i].rightJd + "</td>\n" +//zhu镜
										"<input name='jd' type='hidden' value='" + xml[i].rightJd + "'>\n" +
										"<td>" + xml[i].rightqulv + "</td>\n" +//zhu镜
										"<input name='curvature' type='hidden' value='" + xml[i].rightqulv + "'>\n" +
										"<td>" + xml[i].rightzj + "</td>\n" +//zhu镜
										"<input name='diameter' type='hidden' value='" + xml[i].rightzj + "'>\n" +
										"<td>" + yaoqiuyx[a] + "</td>\n" +//zhu镜
										"<input name='yaoqiu' type='hidden' value='" + yaoqiuyx[a] + "'>\n" +
										"<td style='display:none;'>" + numyx[a] + "</td>\n" +
										"<input name='num' type='hidden' value='" + numyx[a] + "'>\n" +
										"<input name='code' type='hidden' value='" + codeyx[a] + "'>\n" +
										"</tr>"
								);
							}
						}
                        }
                    })
            }
        }


        window.localStorage.removeItem("number");
        window.localStorage.removeItem("eyeStyle");
        window.localStorage.removeItem("mfrsid");
        window.localStorage.removeItem("mfrsname");

        window.localStorage.removeItem("mfrsname");
        window.localStorage.removeItem("hyknum");
        window.localStorage.removeItem("phone");

    });

    //显示
    function show() {
        var eyeStyle = $('#eyeStyle').val();
        if (eyeStyle == '3') {
            $(".val2").remove();
            tab1.style = "display: block";
            tab2.style = "display: none";
        } else if (eyeStyle == '4') {
            $(".val1").remove();
            tab1.style = "display: none";
            tab2.style = "display: block";
        }
    }

    // <!--选择制造商-->
    function choiceMfrs() {
        var goodsid = document.getElementById('eyeStyle').value;
        // layer.alert(goodsid);
        if (goodsid == "") {
            layer.alert("请选择订单类型！");
        } else {
            //选择镜架
            var toIndex = layer.open({
                type: 2,
                title: '制造商',
                maxmin: true,
                shadeClose: false, // 点击遮罩关闭层
                area: ['800px', '520px'],
                content: "/stock/stock/findmfrs/" + goodsid,// iframe的url
                cancel: function (index, layero) {
                    var rows = $(layero).find("iframe")[0].contentWindow.batchSelect();
                    for (var i = 0; i < rows.length; i++) {
                        $("#mfrsName").val(rows[i].mfrsname);
                        $("#mfrsid").val(rows[i].mfrsnum);
                        $("#mfrsNames").val(rows[i].mfrsname);
                    }
                }
            });
            layer.full(toIndex);
        }
    }


    //点击外部配镜
    var htmlheji = ""

    function waibu() {
        var eyeStyle = $('#eyeStyle').val();
        var mfrsid = $('#mfrsid').val();
        var mfrsname = $('#mfrsName').val();
        var zhidanPeople = $('#zhidanPeople').val();
        if (eyeStyle == "") {
            layer.alert("请选择订单类型！");
        } else if (eyeStyle != "" && mfrsid == "") {
            layer.alert("请选择制造商！");
        } else {
            var toIndex = layer.open({
                type: 2,
                title: '外部配镜单查询',
                maxmin: true,
                shadeClose: false, // 点击遮罩关闭层
                area: ['800px', '520px'],
                content: "/stock/weiwai/getGoods/" + eyeStyle + '/' + mfrsid + '/' + mfrsname + '/' + zhidanPeople,// iframe的url
            });
            layer.full(toIndex);
        }
    }


</script>
</body>
</html>
