<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.shiguang.report.dao.SaleReportDao">
	<!-- 收银员工作量统计表 -->
	<select id="findSaleReport" resultType="com.shiguang.storeSales.domain.SalesDO">
		SELECT
		goodsNum,
		amountMoney,
		primeMoney,
		additionalCost,
		additionalPrice,
		additionalCount,
		storeDescribe,
		storeUnit,
		storeCount,
		saleNum,
		isSale,
		payMoney,
		departNumber,
		companyId,
		settleDate,
		saleName,
		saleNumber,
		type
		from
		(
		SELECT
		ss.`goods_num` as goodsNum,
		ss.`amount_money` as amountMoney,
		ss.`prime_money` as primeMoney,
		ss.`additional_cost` as additionalCost,
		ss.`additional_price` as additionalPrice,
		ss.`additional_count` as additionalCount,
		ss.`store_describe` as storeDescribe,
		ss.`store_unit` as storeUnit,
		ss.`store_count` as storeCount,
		su.`username` AS saleNum,
		c.is_sale AS isSale,
		s.`pay_money` AS payMoney,
		d.depart_number as departNumber,
		d.company_id as companyId,
		s.settle_date as settleDate,
		s.sale_name as saleName,
		s.sale_number as saleNumber,
		c.type
		FROM
		store_sales ss
		JOIN settlement s ON s.sale_number = ss.sale_number
		JOIN department d ON d.depart_number = ss.store_num
		JOIN sys_user su ON su. NAME = s.sale_name
		join cost c on c.sale_number = s.sale_number
		union
		SELECT
		'' as goodsNum,
		'' as amountMoney,
		'' as primeMoney,
		'' as additionalCost,
		'' as additionalPrice,
		'' as additionalCount,
		'' as storeDescribe,
		'' as storeUnit,
		'' as storeCount,
		su.`username` AS saleNum,
		c.is_sale AS isSale,
		s.`pay_money` AS payMoney,
		m.depart_number as departNumber,
		d.company_id as companyId,
		s.settle_date as settleDate,
		s.sale_name as saleName,
		s.sale_number as saleNumber,
		c.type
		from cost c
		JOIN settlement s ON s.sale_number = c.sale_number
		join member m on m.card_number = s.member_number
		JOIN sys_user su ON su. NAME = s.sale_name
		join department d on d.depart_number = m.depart_number) a
		<where>
			<if test="departNumber != null and departNumber != ''"> and departNumber = #{departNumber} </if>
			<if test="companyid !=null and companyid != ''">and companyId in (#{companyid})</if>
			<if test="saleNum != null and saleNum !=''">and saleNum = #{saleNum}</if>
			<if test="settleDateStart !=null and settleDateStart != ''">and date_format(settleDate ,'%Y-%m-%d' ) >= #{settleDateStart}</if>
			<if test="settleDateEnd !=null and settleDateEnd != ''">and date_format(settleDate ,'%Y-%m-%d' ) &lt;= #{settleDateEnd}</if>
			and (`type`='配镜单' or `type`='定金单' OR `type` = '检查单')
			and isSale != 0
		</where>
		GROUP BY saleNumber


		<!--select ss.`sale_name`,ss.`sale_number`,ss.`goods_num`,ss.`amount_money`,ss.`prime_money`,ss.`additional_cost`,ss.`additional_price`,-->
		<!--ss.`additional_count`,ss.`store_describe`,ss.`store_unit`,ss.`store_count`,su.`username` as saleNum,c.`is_sale` as isSale,s.`pay_money` as payMoney-->
		<!--from store_sales ss-->
		<!--join settlement s on s.sale_number = ss.sale_number-->
		<!--join department d on d.depart_number = ss.store_num-->
		<!--join sys_user su on su.name = ss.sale_name-->
		<!--join cost c on c.sale_number = ss.sale_number-->
		<!--<where>-->
		<!--<if test="departNumber != null and departNumber != ''"> and d.depart_number = #{departNumber} </if>-->
		<!--<if test="companyid !=null and companyid != ''">and d.company_id in (#{companyid})</if>-->
		<!--<if test="settleDate !=null and settleDate != ''">and date_format(s.settle_date ,'%Y-%m-%d' ) = (#{settleDate})</if>-->
		<!--and (c.`type`='配镜单' or c.`type`='定金单')-->
		<!--and c.is_sale != 0-->
		<!--</where>-->
		<!--<choose>-->
		<!--<when test="sort != null and sort.trim() != ''">-->
		<!--order by ${sort} ${order}-->
		<!--</when>-->
		<!--<otherwise>-->
		<!--order by s.`settle_date` desc-->
		<!--</otherwise>-->
		<!--</choose>-->
		<!--<if test="offset != null and limit != null">-->
		<!--limit #{offset}, #{limit}-->
		<!--</if>-->
	</select>
	<select id="findSaleReportCount" resultType="int">
		select count(*)
		from store_sales ss
		join settlement s on s.sale_number = ss.sale_number
		join department d on d.depart_number = ss.store_num
		join sys_user su on su.name = ss.sale_name
		<where>
			<if test="departNumber != null and departNumber != ''"> and d.depart_number = #{departNumber} </if>
			<if test="companyid !=null and companyid != ''">and d.company_id in (#{companyid})</if>
			<if test="settleDate !=null and settleDate != ''">and date_format(s.settle_date ,'%Y-%m-%d' ) = (#{settleDate})</if>
		</where>
	</select>
	<!--查询报表中的检查数和检查费 -->
	<select id="findCostList" resultType="com.shiguang.report.domain.SaleReportDO">
		select count(sale_number) as checkCount ,SUM(cost_money) as checkMoney,is_sale as isSale
		from cost
		<where>
			<if test="saleNumber != null and saleNumber !=''">sale_number = #{saleNumber}</if>
			and `type`='检查单'
			and is_sale != 0
		</where>
		group by sale_number
	</select>

	<!-- 查询中心店的营业员的报表 -->
	<select id="findSaleReportForms" resultType="com.shiguang.settlement.domain.SettlementDO">
		select s.`id`,s.`cost_id`,s.`sale_number`,s.`member_number`,s.`sale_name`,s.`sale_acount`,s.`actual_money`,s.`payment_money`,s.`change_money`,s.`pay_model`,
		s.`model_money`,s.`pay_money`,s.`pay_way`,s.`front_money`,s.`settle_date`,s.`front_time`,ss.jifen,su.store as departmentName
		from settlement s join member m on m.card_number = s.member_number join department dt on dt.company_id = m.company_id
		join sys_user su on su.username = s.sale_acount
		left join store_sales ss on ss.sale_number = s.sale_number
		<where>
			<if test="companyid !=null and companyid != ''">and m.company_id in (#{companyid})</if>
			<if test="settleDateStart !=null and settleDateStart != ''"> and date_format(s.settle_date ,'%Y-%m-%d' ) >= (#{settleDateStart})</if>
			<if test="settleDateEnd !=null and settleDateEnd != ''"> and date_format(s.settle_date ,'%Y-%m-%d' ) &lt;= (#{settleDateEnd})</if>
			<if test="state !=null and state != ''">and m.state = #{state}</if>
			<if test="departNumber !=null and departNumber != ''">and su.store_num = #{departNumber}</if>
			<if test="departType !=null and departType != ''">and dt.depart_type = #{departType}</if>
			<if test="saleAccount != null and saleAccount != ''">and s.`sale_acount` = #{saleAccount}</if>
		</where>
		GROUP BY s.sale_number
		order by dt.depart_number
	</select>

	<select id="drawckMoney" resultType="com.shiguang.settlement.domain.SettlementDO">
			SELECT
		s.`id`,
		s.`cost_id`,
		s.`sale_number`,
		s.`member_number`,
		s.`sale_name`,
		s.`sale_acount`,
		s.`actual_money`,
		s.`payment_money`,
		s.`change_money`,
		s.`pay_model`,
		s.`model_money`,
		s.`pay_money`,
		s.`pay_way`,
		s.`front_money`,
		s.`settle_date`,
		s.`front_time`,
		d.`drawback_money` AS drawBackMoney,
		d.`drackback_way` AS drawBackWay,
		su.store AS departmentName
		FROM
		settlement s
		JOIN member m ON m.card_number = s.member_number
		JOIN department dt ON dt.company_id = m.company_id
		join sys_user su on su.username = s.sale_acount
		LEFT JOIN drawback d ON d.sale_number = s.sale_number
		<where>
			<if test="companyid !=null and companyid != ''">and m.company_id in (#{companyid})</if>
			<if test="settleDateStart !=null and settleDateStart != ''"> and date_format(d.create_time ,'%Y-%m-%d' ) >= (#{settleDateStart})</if>
			<if test="settleDateEnd !=null and settleDateEnd != ''"> and date_format(d.create_time ,'%Y-%m-%d' ) &lt;= (#{settleDateEnd})</if>
			<if test="state !=null and state != ''">and m.state = #{state}</if>
			<if test="departNumber !=null and departNumber != ''">and su.store_num = #{departNumber}</if>
			<if test="departType !=null and departType != ''">and dt.depart_type = #{departType}</if>
			<if test="saleAccount != null and saleAccount != ''">and s.`sale_acount` = #{saleAccount}</if>
		</where>
		GROUP BY s.sale_number
		order by dt.depart_number
	</select>
	<select id="findSaleReportFormsCount" resultType="com.shiguang.settlement.domain.SettlementDO">
		select count (*)
		from settlement s join member m on m.card_number = s.member_number join department dt on dt.company_id = m.company_id  left join drawback d on d.sale_number = s.sale_number join sys_user su on su.username = s.sale_acount
		<where>
			<if test="companyid !=null and companyid != ''">and m.company_id in (#{companyid})</if>
			<if test="settleDateStart !=null and settleDateStart != ''">and date_format(s.settle_date ,'%Y-%m-%d' ) >= (#{settleDateStart})</if>
			<if test="settleDateEnd !=null and settleDateEnd != ''">and date_format(s.settle_date ,'%Y-%m-%d' ) &lt;= (#{settleDateEnd})</if>
			<if test="state !=null and state != ''">and m.state = #{state}</if>
			<if test="departNumber !=null and departNumber != ''">and su.store_num = #{departNumber}</if>
			<if test="departType !=null and departType != ''">and dt.depart_type = #{departType}</if>
		</where>
	</select>

	<!-- 商品销售分析表 -->
	<select id="findGoodsList" resultType="com.shiguang.storeSales.domain.SalesDO">
		select s.`id`,s.`ptometry_number`,s.`member_number`,m.`name` as memberName,m.`sex`,m.`age`,m.`phone_1` as phone1,s.`sale_name`,s.`sale_number`,s.`goods_num`,s.`goods_code`,s.`eye_type`,s.`amount_money`,s.`prime_money`,s.`mirror_way`,s.`mirror_time`,
		s.`miror_address`,s.`store_num`,s.`urgent_status`,s.`goods_rebate`,s.`fixed_price`,s.`moling_money`,s.`additional_cost`,s.`process_ask`,
		s.`store_name`,s.`store_describe`,s.`store_unit`,s.`store_count`,s.`remark`,s.`saleremark`,s.`give_name`,s.`peijing_time`,s.`optometry_name`,s.`out_recipel`,s.jj_goods_name,s.`brand_name`,
		s.`recipel_type`,s.`optometrywl_name`,s.`recipelwl_type`,s.`taocan_name`,s.`classtype`,s.`additional_price`,s.`additional_count`,s.`unit`,s.`batch`,s.`left_right`,s.`righttg`,s.`lefttg`
		from store_sales s join settlement st on st.sale_number = s.sale_number join member m on m.card_number = s.member_number
		join department d on d.company_id = m.company_id
		<where>
			<if test="settleDateStart !=null and settleDateStart != ''">and date_format(st.settle_date ,'%Y-%m-%d' ) >= (#{settleDateStart})</if>
			<if test="settleDateEnd !=null and settleDateEnd != ''">and date_format(st.settle_date ,'%Y-%m-%d' ) &lt;= (#{settleDateEnd})</if>
			<if test="state !=null and state != ''">and m.state = #{state}</if>
			<if test="companyid !=null and companyid != ''">and m.company_id in (#{companyid})</if>
			<if test="departNumber !=null and departNumber != ''">and s.store_num = #{departNumber}</if>
			and s.sale_type = '1'
		</where>
		GROUP BY s.sale_number
	</select>

	<select id="findSaleNameList" resultType="com.shiguang.storeSales.domain.SalesDO">
		select s.`sale_account`,s.`sale_name` from store_sales s join settlement st on st.sale_number = s.sale_number join member m on m.card_number = s.member_number
		join department d on d.company_id = m.company_id
		<where>
			<if test="settleDateStart !=null and settleDateStart != ''">and date_format(st.settle_date ,'%Y-%m-%d' ) >= (#{settleDateStart})</if>
			<if test="settleDateEnd !=null and settleDateEnd != ''">and date_format(st.settle_date ,'%Y-%m-%d' ) &lt;= (#{settleDateEnd})</if>
			<if test="state !=null and state != ''">and m.state = #{state}</if>
			<if test="companyid !=null and companyid != ''">and m.company_id in (#{companyid})</if>
			<if test="departNumber !=null and departNumber != ''">and s.store_num= #{departNumber}</if>
		</where>
		GROUP BY s.sale_name
	</select>

	<select id="findSaleNameSettleList" resultType="com.shiguang.settlement.domain.SettlementDO">
		select s.`sale_name`,s.`sale_acount` from settlement s join store_sales ss on ss.sale_number = s.sale_number  join member m on m.card_number = s.member_number
		<where>
			<if test="companyid !=null and companyid != ''">and m.company_id in (#{companyid})</if>
			<if test="settleDateStart !=null and settleDateStart != ''"> and date_format(s.settle_date ,'%Y-%m-%d' ) >= (#{settleDateStart})</if>
			<if test="settleDateEnd !=null and settleDateEnd != ''"> and date_format(s.settle_date ,'%Y-%m-%d' ) &lt;= (#{settleDateEnd})</if>
			<if test="state !=null and state != ''">and m.state = #{state}</if>
			<if test="departNumber !=null and departNumber != ''">and ss.store_num = #{departNumber}</if>
			and (ss.sale_type = '1')
		</where>
		GROUP BY s.sale_name
	</select>

	<select id="findSaleReportDetailForms" resultType="com.shiguang.storeSales.domain.SalesDO">
		select s.`id`,s.`ptometry_number`,s.`member_number`,m.`name` as memberName,m.`sex`,m.`age`,m.`phone_1` as phone1,s.`sale_account`,s.`sale_number`,s.`goods_num`,s.`goods_code`,s.`eye_type`,s.`amount_money`,s.`prime_money`,s.`mirror_way`,s.`mirror_time`,
		s.`miror_address`,s.`store_num`,s.`urgent_status`,s.`goods_rebate`,s.`fixed_price`,s.`moling_money`,s.`additional_cost`,s.`process_ask`,
		s.`store_name`,s.`store_describe`,s.`store_unit`,s.`store_count`,s.`remark`,s.`saleremark`,s.`give_name`,s.`peijing_time`,s.`optometry_name`,s.`out_recipel`,s.jj_goods_name,st.`sale_name`,st.`sale_acount` as saleAccount,
		s.`recipel_type`,s.`optometrywl_name`,s.`recipelwl_type`,s.`taocan_name`,s.`classtype`,s.`additional_price`,s.`additional_count`,s.`unit`,s.`batch`,s.`left_right`,s.`righttg`,s.`lefttg`,
		st.`change_money`,st.`model_money`,s.sale_type
		from store_sales s join settlement st on st.sale_number = s.sale_number join member m on m.card_number = s.member_number
		join department d on d.company_id = m.company_id
		<where>
			<if test="companyid !=null and companyid != ''">and m.company_id in (#{companyid})</if>
			<if test="settleDateStart !=null and settleDateStart != ''"> and date_format(st.settle_date ,'%Y-%m-%d' ) >= (#{settleDateStart})</if>
			<if test="settleDateEnd !=null and settleDateEnd != ''"> and date_format(st.settle_date ,'%Y-%m-%d' ) &lt;= (#{settleDateEnd})</if>
			<if test="state !=null and state != ''">and m.state = #{state}</if>
			<if test="departNumber !=null and departNumber != ''">and s.store_num = #{departNumber}</if>
			and (s.sale_type = '1')
		</where>
		GROUP BY s.sale_number
	</select>

	<select id="findYanguangPeople" resultType="com.shiguang.storeSales.domain.SalesDO">
		select  u.store,u.username,u.name
		from  sys_user u
		join sys_user_role ur on u.user_id=ur.user_id
		<where>
			<if test="companyId !=null and companyId != ''">and u.company_id in (#{companyId})</if>
			<if test="department !=null and department != ''">and u.store = #{department}</if>
			and (ur.role_id = 7)
		</where>
		GROUP BY u.username
	</select>
	<select id="findYanguangCount" resultType="int">
	select  COUNT(try.ptometry_number) as ygcount
	from  sys_user u
	join sys_user_role ur on u.user_id=ur.user_id
	left join jc_tryresults try on try.optometry_name=u.name
	<where>
	<if test="companyId !=null and companyId != ''">and u.company_id in (#{companyId})</if>
	<if test="settleDateStart !=null and settleDateStart != ''"> and date_format(try.create_time ,'%Y-%m-%d' ) >= (#{settleDateStart})</if>
	<if test="settleDateEnd !=null and settleDateEnd != ''"> and date_format(try.create_time ,'%Y-%m-%d' ) &lt;= (#{settleDateEnd})</if>
	<if test="department !=null and department != ''">and u.store = #{department}</if>
	<if test="username !=null and username != ''">and u.username = #{username}</if>
	and (ur.role_id = 7)
	</where>
	</select>




	<select id="findUseCount"  resultType="int">
		SELECT
		COUNT( ptometry_number ) AS usecount
		FROM
		(
		SELECT
		ptometry_number,
		company_id,
		create_time,
		username,
		role_id,
		sale_type,
		store,
		sale_number,new_old
		FROM
		(
		SELECT
		kjyy.ptometry_number,
		u.company_id,
		kjyy.create_time,
		u.username,
		ur.role_id,
		s.sale_type,
		u.store,
		s.sale_number,kjyy.new_old
		FROM
		jc_kjyy kjyy
		JOIN sys_user u ON kjyy.kjyy_optometry_name = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
		JOIN store_sales s ON kjyy.ptometry_number = s.ptometry_number UNION ALL
		SELECT
		kjjy.ptometry_number,
		u.company_id,
		kjjy.create_time,
		u.username,
		ur.role_id,
		s.sale_type,
		u.store,
		s.sale_number,kjjy.new_old
		FROM
		jc_kjjy kjjy
		JOIN sys_user u ON kjjy.kjjy_optometry_name = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
		JOIN store_sales s ON kjjy.ptometry_number = s.ptometry_number UNION ALL
		SELECT
		sgjj.ptometry_number,
		u.company_id,
		sgjj.create_time,
		u.username,
		ur.role_id,
		s.sale_type,
		u.store,
		s.sale_number,sgjj.new_old
		FROM
		jc_sgjj sgjj
		JOIN sys_user u ON sgjj.sgjj_optometry_name = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
		JOIN store_sales s ON sgjj.ptometry_number = s.ptometry_number UNION ALL
		SELECT
		rx.ptometry_number,
		u.company_id,
		rx.create_time,
		u.username,
		ur.role_id,
		s.sale_type,
		u.store,
		s.sale_number,rx.new_old
		FROM
		jc_rxjmjcj rx
		JOIN sys_user u ON rx.rx_optometry_name = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
		JOIN store_sales s ON rx.ptometry_number = s.ptometry_number UNION ALL
		SELECT
		zy.ptometry_number,
		u.company_id,
		zy.create_time,
		u.username,
		ur.role_id,
		s.sale_type,
		u.store,
		s.sale_number,zy.new_old
		FROM
		jc_zy zy
		JOIN sys_user u ON zy.zy_optometry_name = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
		JOIN store_sales s ON zy.ptometry_number = s.ptometry_number UNION ALL
		SELECT
		sjxl.ptometry_number,
		u.company_id,
		sjxl.create_time,
		u.username,
		ur.role_id,
		s.sale_type,
		u.store,
		s.sale_number,sjxl.new_old
		FROM
		jc_sjxl sjxl
		JOIN sys_user u ON sjxl.sjxl_optometry_name = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
		JOIN store_sales s ON sjxl.ptometry_number = s.ptometry_number UNION ALL
		SELECT
		vst.ptometry_number,
		u.company_id,
		vst.create_time,
		u.username,
		ur.role_id,
		s.sale_type,
		u.store,
		s.sale_number,vst.new_old
		FROM
		jc_vst vst
		JOIN sys_user u ON vst.vst_optometry_name = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
		JOIN store_sales s ON vst.ptometry_number = s.ptometry_number UNION ALL
		SELECT
		crt.ptometry_number,
		u.company_id,
		crt.create_time,
		u.username,
		ur.role_id,
		s.sale_type,
		u.store,
		s.sale_number,crt.new_old
		FROM
		jc_crt crt
		JOIN sys_user u ON crt.crt_optometry_name = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
		JOIN store_sales s ON crt.ptometry_number = s.ptometry_number UNION ALL
		SELECT
		rgp.ptometry_number,
		u.company_id,
		rgp.create_time,
		u.username,
		ur.role_id,
		s.sale_type,
		u.store,
		s.sale_number,rgp.new_old
		FROM
		jc_rgp rgp
		JOIN sys_user u ON rgp.rgp_optometry_name = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
		JOIN store_sales s ON rgp.ptometry_number = s.ptometry_number UNION ALL
		SELECT
		yp.ptometry_number,
		u.company_id,
		yp.create_time,
		u.username,
		ur.role_id,
		s.sale_type,
		u.store,
		s.sale_number,yp.new_old
		FROM
		jc_yaopin yp
		JOIN sys_user u ON yp.yp_optometry_name = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
		JOIN store_sales s ON yp.ptometry_number = s.ptometry_number
		) aia
		<where>
			<if test="companyId !=null and companyId != ''">and  company_id in (#{companyId})</if>
			<if test="settleDateStart !=null and settleDateStart != ''"> and date_format( create_time ,'%Y-%m-%d' ) >= (#{settleDateStart})</if>
			<if test="settleDateEnd !=null and settleDateEnd != ''"> and date_format( create_time ,'%Y-%m-%d' ) &lt;= (#{settleDateEnd})</if>
			<if test="department !=null and department != ''">and  store = #{department}</if>
			<if test="username !=null and username != ''">and  username = #{username}</if>
			<if test="newOld !=null and newOld != ''">and  new_old = #{newOld}</if>
			and ( role_id = 7)and ( sale_type=1)
		</where>
        GROUP BY sale_number
		) ai


	</select>
	<select id="findamountMoney" resultType="int">
		SELECT
		ifnull( sum( amount_money ), 0 ) AS amountMoney
		FROM
		(
		SELECT
		ptometry_number,
		company_id,
		create_time,
		username,
		role_id,
		sale_type,
		store,
		sale_number,
		amount_money,new_old
		FROM
		(
		SELECT
		kjyy.ptometry_number,
		u.company_id,
		kjyy.create_time,
		u.username,
		ur.role_id,
		s.sale_type,
		u.store,
		s.sale_number,
		s.amount_money,kjyy.new_old
		FROM
		jc_kjyy kjyy
		JOIN sys_user u ON kjyy.kjyy_optometry_name = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
		JOIN store_sales s ON kjyy.ptometry_number = s.ptometry_number UNION ALL
		SELECT
		kjjy.ptometry_number,
		u.company_id,
		kjjy.create_time,
		u.username,
		ur.role_id,
		s.sale_type,
		u.store,
		s.sale_number,
		s.amount_money,kjjy.new_old
		FROM
		jc_kjjy kjjy
		JOIN sys_user u ON kjjy.kjjy_optometry_name = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
		JOIN store_sales s ON kjjy.ptometry_number = s.ptometry_number UNION ALL
		SELECT
		sgjj.ptometry_number,
		u.company_id,
		sgjj.create_time,
		u.username,
		ur.role_id,
		s.sale_type,
		u.store,
		s.sale_number,
		s.amount_money,sgjj.new_old
		FROM
		jc_sgjj sgjj
		JOIN sys_user u ON sgjj.sgjj_optometry_name = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
		JOIN store_sales s ON sgjj.ptometry_number = s.ptometry_number UNION ALL
		SELECT
		rx.ptometry_number,
		u.company_id,
		rx.create_time,
		u.username,
		ur.role_id,
		s.sale_type,
		u.store,
		s.sale_number,
		s.amount_money,rx.new_old
		FROM
		jc_rxjmjcj rx
		JOIN sys_user u ON rx.rx_optometry_name = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
		JOIN store_sales s ON rx.ptometry_number = s.ptometry_number UNION ALL
		SELECT
		zy.ptometry_number,
		u.company_id,
		zy.create_time,
		u.username,
		ur.role_id,
		s.sale_type,
		u.store,
		s.sale_number,
		s.amount_money,zy.new_old
		FROM
		jc_zy zy
		JOIN sys_user u ON zy.zy_optometry_name = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
		JOIN store_sales s ON zy.ptometry_number = s.ptometry_number UNION ALL
		SELECT
		sjxl.ptometry_number,
		u.company_id,
		sjxl.create_time,
		u.username,
		ur.role_id,
		s.sale_type,
		u.store,
		s.sale_number,
		s.amount_money,sjxl.new_old
		FROM
		jc_sjxl sjxl
		JOIN sys_user u ON sjxl.sjxl_optometry_name = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
		JOIN store_sales s ON sjxl.ptometry_number = s.ptometry_number UNION ALL
		SELECT
		vst.ptometry_number,
		u.company_id,
		vst.create_time,
		u.username,
		ur.role_id,
		s.sale_type,
		u.store,
		s.sale_number,
		s.amount_money,vst.new_old
		FROM
		jc_vst vst
		JOIN sys_user u ON vst.vst_optometry_name = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
		JOIN store_sales s ON vst.ptometry_number = s.ptometry_number UNION ALL
		SELECT
		crt.ptometry_number,
		u.company_id,
		crt.create_time,
		u.username,
		ur.role_id,
		s.sale_type,
		u.store,
		s.sale_number,
		s.amount_money,crt.new_old
		FROM
		jc_crt crt
		JOIN sys_user u ON crt.crt_optometry_name = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
		JOIN store_sales s ON crt.ptometry_number = s.ptometry_number UNION ALL
		SELECT
		rgp.ptometry_number,
		u.company_id,
		rgp.create_time,
		u.username,
		ur.role_id,
		s.sale_type,
		u.store,
		s.sale_number,
		s.amount_money,rgp.new_old
		FROM
		jc_rgp rgp
		JOIN sys_user u ON rgp.rgp_optometry_name = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
		JOIN store_sales s ON rgp.ptometry_number = s.ptometry_number UNION ALL
		SELECT
		yp.ptometry_number,
		u.company_id,
		yp.create_time,
		u.username,
		ur.role_id,
		s.sale_type,
		u.store,
		s.sale_number,
		s.amount_money,yp.new_old
		FROM
		jc_yaopin yp
		JOIN sys_user u ON yp.yp_optometry_name = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
		JOIN store_sales s ON yp.ptometry_number = s.ptometry_number
		) aia
		<where>
			<if test="companyId !=null and companyId != ''">and  company_id in (#{companyId})</if>
			<if test="settleDateStart !=null and settleDateStart != ''"> and date_format( create_time ,'%Y-%m-%d' ) >= (#{settleDateStart})</if>
			<if test="settleDateEnd !=null and settleDateEnd != ''"> and date_format( create_time ,'%Y-%m-%d' ) &lt;= (#{settleDateEnd})</if>
			<if test="department !=null and department != ''">and  store = #{department}</if>
			<if test="username !=null and username != ''">and  username = #{username}</if>
			<if test="newOld !=null and newOld != ''">and  new_old = #{newOld}</if>
			and ( role_id = 7)and ( sale_type=1)
		</where>
		GROUP BY
		sale_number
		) ai

	</select>
	<select id="findGoods" resultType="com.shiguang.storeSales.domain.SalesDO">
		SELECT
		company_id,
		store,
		username,
		role_id,
		NAME,
		sale_number,
		goods_num,
		store_name,
		store_describe,
		classtype,
		store_count,
		store_unit,
		amount_money,
		sale_type,
		create_time,new_old
		FROM
		(
		SELECT
		u.company_id,
		u.store,
		u.username,
		ur.role_id,
		u.NAME,
		s.sale_number,
		s.goods_num,
		s.store_name,
		s.store_describe,
		s.classtype,
		s.store_count,
		s.store_unit,
		s.amount_money,
		s.sale_type,
		kjyy.create_time,
		kjyy.new_old
		FROM
		jc_kjyy kjyy
		JOIN sys_user u ON kjyy.kjyy_optometry_name = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
		JOIN store_sales s ON kjyy.ptometry_number = s.ptometry_number UNION ALL
		SELECT
		u.company_id,
		u.store,
		u.username,
		ur.role_id,
		u.NAME,
		s.sale_number,
		s.goods_num,
		s.store_name,
		s.store_describe,
		s.classtype,
		s.store_count,
		s.store_unit,
		s.amount_money,
		s.sale_type,
		kjjy.create_time,
		kjjy.new_old
		FROM
		jc_kjjy kjjy
		JOIN sys_user u ON kjjy.kjjy_optometry_name = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
		JOIN store_sales s ON kjjy.ptometry_number = s.ptometry_number UNION ALL
		SELECT
		u.company_id,
		u.store,
		u.username,
		ur.role_id,
		u.NAME,
		s.sale_number,
		s.goods_num,
		s.store_name,
		s.store_describe,
		s.classtype,
		s.store_count,
		s.store_unit,
		s.amount_money,
		s.sale_type,
		sgjj.create_time,
		sgjj.new_old
		FROM
		jc_sgjj sgjj
		JOIN sys_user u ON sgjj.sgjj_optometry_name = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
		JOIN store_sales s ON sgjj.ptometry_number = s.ptometry_number UNION ALL
		SELECT
		u.company_id,
		u.store,
		u.username,
		ur.role_id,
		u.NAME,
		s.sale_number,
		s.goods_num,
		s.store_name,
		s.store_describe,
		s.classtype,
		s.store_count,
		s.store_unit,
		s.amount_money,
		s.sale_type,
		rx.create_time,
		rx.new_old
		FROM
		jc_rxjmjcj rx
		JOIN sys_user u ON rx.rx_optometry_name = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
		JOIN store_sales s ON rx.ptometry_number = s.ptometry_number UNION ALL
		SELECT
		u.company_id,
		u.store,
		u.username,
		ur.role_id,
		u.NAME,
		s.sale_number,
		s.goods_num,
		s.store_name,
		s.store_describe,
		s.classtype,
		s.store_count,
		s.store_unit,
		s.amount_money,
		s.sale_type,
		zy.create_time,
		zy.new_old
		FROM
		jc_zy zy
		JOIN sys_user u ON zy.zy_optometry_name = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
		JOIN store_sales s ON zy.ptometry_number = s.ptometry_number UNION ALL
		SELECT
		u.company_id,
		u.store,
		u.username,
		ur.role_id,
		u.NAME,
		s.sale_number,
		s.goods_num,
		s.store_name,
		s.store_describe,
		s.classtype,
		s.store_count,
		s.store_unit,
		s.amount_money,
		s.sale_type,
		sjxl.create_time,
		sjxl.new_old
		FROM
		jc_sjxl sjxl
		JOIN sys_user u ON sjxl.sjxl_optometry_name = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
		JOIN store_sales s ON sjxl.ptometry_number = s.ptometry_number UNION ALL
		SELECT
		u.company_id,
		u.store,
		u.username,
		ur.role_id,
		u.NAME,
		s.sale_number,
		s.goods_num,
		s.store_name,
		s.store_describe,
		s.classtype,
		s.store_count,
		s.store_unit,
		s.amount_money,
		s.sale_type,
		vst.create_time,
		vst.new_old
		FROM
		jc_vst vst
		JOIN sys_user u ON vst.vst_optometry_name = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
		JOIN store_sales s ON vst.ptometry_number = s.ptometry_number UNION ALL
		SELECT
		u.company_id,
		u.store,
		u.username,
		ur.role_id,
		u.NAME,
		s.sale_number,
		s.goods_num,
		s.store_name,
		s.store_describe,
		s.classtype,
		s.store_count,
		s.store_unit,
		s.amount_money,
		s.sale_type,
		crt.create_time,
		crt.new_old
		FROM
		jc_crt crt
		JOIN sys_user u ON crt.crt_optometry_name = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
		JOIN store_sales s ON crt.ptometry_number = s.ptometry_number UNION ALL
		SELECT
		u.company_id,
		u.store,
		u.username,
		ur.role_id,
		u.NAME,
		s.sale_number,
		s.goods_num,
		s.store_name,
		s.store_describe,
		s.classtype,
		s.store_count,
		s.store_unit,
		s.amount_money,
		s.sale_type,
		rgp.create_time,
		rgp.new_old
		FROM
		jc_rgp rgp
		JOIN sys_user u ON rgp.rgp_optometry_name = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
		JOIN store_sales s ON rgp.ptometry_number = s.ptometry_number UNION ALL
		SELECT
		u.company_id,
		u.store,
		u.username,
		ur.role_id,
		u.NAME,
		s.sale_number,
		s.goods_num,
		s.store_name,
		s.store_describe,
		s.classtype,
		s.store_count,
		s.store_unit,
		s.amount_money,
		s.sale_type,
		yp.create_time,
		yp.new_old
		FROM
		jc_yaopin yp
		JOIN sys_user u ON yp.yp_optometry_name = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
		JOIN store_sales s ON yp.ptometry_number = s.ptometry_number
		) aia
		<where>
			<if test="companyId !=null and companyId != ''">and  company_id in (#{companyId})</if>
			<if test="settleDateStart !=null and settleDateStart != ''"> and date_format( create_time ,'%Y-%m-%d' ) >= (#{settleDateStart})</if>
			<if test="settleDateEnd !=null and settleDateEnd != ''"> and date_format( create_time ,'%Y-%m-%d' ) &lt;= (#{settleDateEnd})</if>
			<if test="department !=null and department != ''">and  store = #{department}</if>
			<if test="username !=null and username != ''">and  username = #{username}</if>
			<if test="newOld !=null and newOld != ''">and  new_old = #{newOld}</if>
			<if test="storeDescribe != null and storeDescribe != ''">and  store_describe LIKE concat(concat('%', #{storeDescribe}),'%')</if>
			<if test="brandname != null and brandname != ''">and   store_name LIKE concat(concat('%', #{brandname}),'%')</if>
			and ( role_id = 7) and ( sale_type=1)
		</where>
		GROUP BY
		sale_number


	</select>

	<select id="findJj" resultType="com.shiguang.product.domain.ProducaDO">
		select a.produc_num,a.view_good_name  ,a.brandnum,b.brandname  from aa_produca a
		join c_brand b on a.brandnum=b.brandnum   and a.mfrsid=b.mfrsid
		where a.produc_num = #{value}
	</select>
	<select id="findpj" resultType="com.shiguang.product.domain.PartsDO">
		select a.produc_num,a.view_good_name  ,a.brandnum,b.brandname   from aa_parts a
		join c_brand b on a.brandnum=b.brandnum   and a.mfrsid=b.mfrsid
		where a.produc_num = #{value}
	</select>
	<select id="findjp" resultType="com.shiguang.product.domain.JpcpDO">
		select a.produc_num,a.view_good_name  ,a.brandnum,b.brandname   from aa_jpcp a
		join c_brand b on a.brandnum=b.brandnum   and a.mfrsid=b.mfrsid
		where a.produc_num = #{value}
	</select>

	<select id="findjpdz" resultType="com.shiguang.product.domain.JpdzDO">
		select a.produc_num,a.view_good_name  ,a.brandnum,b.brandname   from aa_jpdz a
		join c_brand b on a.brandnum=b.brandnum   and a.mfrsid=b.mfrsid
		where a.produc_num = #{value}
	</select>
	<select id="findyx" resultType="com.shiguang.product.domain.YxcpDO">
		select a.produc_num,a.view_good_name  ,a.brandnum,b.brandname   from aa_yxcp a
		join c_brand b on a.brandnum=b.brandnum   and a.mfrsid=b.mfrsid
		where a.produc_num = #{value}
	</select>
	<select id="findyxdz" resultType="com.shiguang.product.domain.YxdzDO">
		select a.produc_num,a.view_good_name  ,a.brandnum,b.brandname   from aa_yxdz a
		join c_brand b on a.brandnum=b.brandnum   and a.mfrsid=b.mfrsid
		where a.produc_num = #{value}
	</select>
	<select id="findhly" resultType="com.shiguang.product.domain.HlyDO">
		select a.produc_num,a.view_good_name  ,a.brandnum,b.brandname   from aa_hly a
		join c_brand b on a.brandnum=b.brandnum   and a.mfrsid=b.mfrsid
		where a.produc_num = #{value}
	</select>
	<select id="findtyj" resultType="com.shiguang.product.domain.TyjDO">
		select a.produc_num,a.view_good_name  ,a.brandnum,b.brandname   from aa_tyj a
		join c_brand b on a.brandnum=b.brandnum   and a.mfrsid=b.mfrsid
		where a.produc_num = #{value}
	</select>

	<select id="findlhj" resultType="com.shiguang.product.domain.OldlensDO">
		select a.produc_num,a.view_good_name  ,a.brandnum,b.brandname   from aa_oldlens a
		join c_brand b on a.brandnum=b.brandnum   and a.mfrsid=b.mfrsid
		where a.produc_num = #{value}
	</select>
	<select id="findhc" resultType="com.shiguang.product.domain.HcDO">
		select a.produc_num,a.view_good_name  ,a.brandnum,b.brandname   from aa_hc a
		join c_brand b on a.brandnum=b.brandnum   and a.mfrsid=b.mfrsid
		where a.produc_num = #{value}
	</select>
	<select id="findsg" resultType="com.shiguang.product.domain.ShiguangDO">
		select a.produc_num,a.view_good_name  ,a.brandnum,b.brandname   from aa_shiguang a
		join c_brand b on a.brandnum=b.brandnum   and a.mfrsid=b.mfrsid
		where a.produc_num = #{value}
	</select>


    <select id="ygDoctorUse" resultType="com.shiguang.storeSales.domain.SalesDO">
        SELECT
        ptometry_number,
        company_id,
        create_time,
        username,
        role_id,
        sale_type,
        store,
        sale_number,
        doctor,new_old
        FROM
        (
        SELECT
        kjyy.ptometry_number,
        u.company_id,
        kjyy.create_time,
        u.username,
        ur.role_id,
        s.sale_type,
        u.store,
        s.sale_number,
        kjyy.kjyy_doctor as doctor,
		kjyy.new_old
        FROM
        jc_kjyy kjyy
        JOIN sys_user u ON kjyy.kjyy_optometry_name = u.
        NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
        JOIN store_sales s ON kjyy.ptometry_number = s.ptometry_number UNION ALL
        SELECT
        kjjy.ptometry_number,
        u.company_id,
        kjjy.create_time,
        u.username,
        ur.role_id,
        s.sale_type,
        u.store,
        s.sale_number,
        kjjy.kjjy_doctor  as doctor,
		kjjy.new_old
        FROM
        jc_kjjy kjjy
        JOIN sys_user u ON kjjy.kjjy_optometry_name = u.
        NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
        JOIN store_sales s ON kjjy.ptometry_number = s.ptometry_number UNION ALL
        SELECT
        sgjj.ptometry_number,
        u.company_id,
        sgjj.create_time,
        u.username,
        ur.role_id,
        s.sale_type,
        u.store,
        s.sale_number,
        sgjj.sgjj_doctor  as doctor,
		sgjj.new_old
        FROM
        jc_sgjj sgjj
        JOIN sys_user u ON sgjj.sgjj_optometry_name = u.
        NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
        JOIN store_sales s ON sgjj.ptometry_number = s.ptometry_number UNION ALL
        SELECT
        rx.ptometry_number,
        u.company_id,
        rx.create_time,
        u.username,
        ur.role_id,
        s.sale_type,
        u.store,
        s.sale_number,
        rx.rx_doctor  as doctor,
		rx.new_old
        FROM
        jc_rxjmjcj rx
        JOIN sys_user u ON rx.rx_optometry_name = u.
        NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
        JOIN store_sales s ON rx.ptometry_number = s.ptometry_number UNION ALL
        SELECT
        zy.ptometry_number,
        u.company_id,
        zy.create_time,
        u.username,
        ur.role_id,
        s.sale_type,
        u.store,
        s.sale_number,
        zy.zy_doctor  as doctor,
		zy.new_old
        FROM
        jc_zy zy
        JOIN sys_user u ON zy.zy_optometry_name = u.
        NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
        JOIN store_sales s ON zy.ptometry_number = s.ptometry_number UNION ALL
        SELECT
        sjxl.ptometry_number,
        u.company_id,
        sjxl.create_time,
        u.username,
        ur.role_id,
        s.sale_type,
        u.store,
        s.sale_number,
        sjxl.sjxl_doctor  as doctor,
		sjxl.new_old
        FROM
        jc_sjxl sjxl
        JOIN sys_user u ON sjxl.sjxl_optometry_name = u.
        NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
        JOIN store_sales s ON sjxl.ptometry_number = s.ptometry_number UNION ALL
        SELECT
        vst.ptometry_number,
        u.company_id,
        vst.create_time,
        u.username,
        ur.role_id,
        s.sale_type,
        u.store,
        s.sale_number,
        vst.vst_doctor  as doctor,
		vst.new_old
        FROM
        jc_vst vst
        JOIN sys_user u ON vst.vst_optometry_name = u.
        NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
        JOIN store_sales s ON vst.ptometry_number = s.ptometry_number UNION ALL
        SELECT
        crt.ptometry_number,
        u.company_id,
        crt.create_time,
        u.username,
        ur.role_id,
        s.sale_type,
        u.store,
        s.sale_number,
        crt.crt_doctor  as doctor,
		crt.new_old
        FROM
        jc_crt crt
        JOIN sys_user u ON crt.crt_optometry_name = u.
        NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
        JOIN store_sales s ON crt.ptometry_number = s.ptometry_number UNION ALL
        SELECT
        rgp.ptometry_number,
        u.company_id,
        rgp.create_time,
        u.username,
        ur.role_id,
        s.sale_type,
        u.store,
        s.sale_number,
        rgp.rgp_doctor  as doctor,
		rgp.new_old
        FROM
        jc_rgp rgp
        JOIN sys_user u ON rgp.rgp_optometry_name = u.
        NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
        JOIN store_sales s ON rgp.ptometry_number = s.ptometry_number UNION ALL
        SELECT
        yp.ptometry_number,
        u.company_id,
        yp.create_time,
        u.username,
        ur.role_id,
        s.sale_type,
        u.store,
        s.sale_number,
        yp.yp_doctor  as doctor,
		yp.new_old
        FROM
        jc_yaopin yp
        JOIN sys_user u ON yp.yp_optometry_name = u.
        NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
        JOIN store_sales s ON yp.ptometry_number = s.ptometry_number
        ) aia
        <where>
            <if test="companyId !=null and companyId != ''">and  company_id in (#{companyId})</if>
            <if test="settleDateStart !=null and settleDateStart != ''"> and date_format( create_time ,'%Y-%m-%d' ) >= (#{settleDateStart})</if>
            <if test="settleDateEnd !=null and settleDateEnd != ''"> and date_format( create_time ,'%Y-%m-%d' ) &lt;= (#{settleDateEnd})</if>
            <if test="department !=null and department != ''">and  store = #{department}</if>
            <if test="username !=null and username != ''">and  username = #{username}</if>
            <if test="newOld !=null and newOld != ''">and  new_old = #{newOld}</if>
            <if test="storeDescribe != null and storeDescribe != ''">and  store_describe LIKE concat(concat('%', #{storeDescribe}),'%')</if>
            <if test="brandname != null and brandname != ''">and   store_name LIKE concat(concat('%', #{brandname}),'%')</if>
            and ( role_id = 7) and ( sale_type=1)
        </where>
        GROUP BY
        sale_number


    </select>
	<select id="ygDoctor" resultType="com.shiguang.storeSales.domain.SalesDO">
		SELECT
		ptometry_number,
		company_id,
		create_time,
		username,
		role_id,
		store,
		doctor ,
		cfstype,new_old
		FROM
		(
		SELECT
		kjyy.ptometry_number,
		kjyy.kjyy_prescription_type as cfstype ,
		u.company_id,
		kjyy.create_time,
		u.username,
		ur.role_id,
		u.store,
		kjyy.kjyy_doctor AS doctor,
		kjyy.new_old
		FROM
		jc_kjyy kjyy
		JOIN sys_user u ON kjyy.kjyy_optometry_name = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id UNION ALL
		SELECT
		kjjy.ptometry_number,
		kjjy.kjjy_prescription_type as cfstype ,
		u.company_id,
		kjjy.create_time,
		u.username,
		ur.role_id,
		u.store,
		kjjy.kjjy_doctor AS doctor,
		kjjy.new_old
		FROM
		jc_kjjy kjjy
		JOIN sys_user u ON kjjy.kjjy_optometry_name = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id UNION ALL
		SELECT
		sgjj.ptometry_number,
		sgjj.sgjj_prescription_type as cfstype,
		u.company_id,
		sgjj.create_time,
		u.username,
		ur.role_id,
		u.store,
		sgjj.sgjj_doctor AS doctor,
		sgjj.new_old
		FROM
		jc_sgjj sgjj
		JOIN sys_user u ON sgjj.sgjj_optometry_name = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id UNION ALL
		SELECT
		rx.ptometry_number,
		rx.rx_prescription_type as cfstype,
		u.company_id,
		rx.create_time,
		u.username,
		ur.role_id,
		u.store,
		rx.rx_doctor AS doctor,
		rx.new_old
		FROM
		jc_rxjmjcj rx
		JOIN sys_user u ON rx.rx_optometry_name = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id UNION ALL
		SELECT
		zy.ptometry_number,
		zy.zy_prescription_type as cfstype,
		u.company_id,
		zy.create_time,
		u.username,
		ur.role_id,
		u.store,
		zy.zy_doctor AS doctor,
		zy.new_old
		FROM
		jc_zy zy
		JOIN sys_user u ON zy.zy_optometry_name = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id UNION ALL
		SELECT
		sjxl.ptometry_number,
		sjxl.sjxl_prescription_type as cfstype ,
		u.company_id,
		sjxl.create_time,
		u.username,
		ur.role_id,
		u.store,
		sjxl.sjxl_doctor AS doctor,
		sjxl.new_old
		FROM
		jc_sjxl sjxl
		JOIN sys_user u ON sjxl.sjxl_optometry_name = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id UNION ALL
		SELECT
		vst.ptometry_number,
		vst.vst_prescription_type as cfstype,
		u.company_id,
		vst.create_time,
		u.username,
		ur.role_id,
		u.store,
		vst.vst_doctor AS doctor,
		vst.new_old
		FROM
		jc_vst vst
		JOIN sys_user u ON vst.vst_optometry_name = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id UNION ALL
		SELECT
		crt.ptometry_number,
		crt.crt_prescription_type as cfstype,
		u.company_id,
		crt.create_time,
		u.username,
		ur.role_id,
		u.store,
		crt.crt_doctor AS doctor,
		crt.new_old
		FROM
		jc_crt crt
		JOIN sys_user u ON crt.crt_optometry_name = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id UNION ALL
		SELECT
		rgp.ptometry_number,
		rgp.rgp_prescription_type as cfstype,
		u.company_id,
		rgp.create_time,
		u.username,
		ur.role_id,
		u.store,
		rgp.rgp_doctor AS doctor,
		rgp.new_old
		FROM
		jc_rgp rgp
		JOIN sys_user u ON rgp.rgp_optometry_name = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id UNION ALL
		SELECT
		yp.ptometry_number,
		yp.yp_prescription_type as cfstype,
		u.company_id,
		yp.create_time,
		u.username,
		ur.role_id,
		u.store,
		yp.yp_doctor AS doctor,
		yp.new_old
		FROM
		jc_yaopin yp
		JOIN sys_user u ON yp.yp_optometry_name = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
		) aia
		<where>
			<if test="companyId !=null and companyId != ''">and  company_id in (#{companyId})</if>
			<if test="settleDateStart !=null and settleDateStart != ''"> and date_format( create_time ,'%Y-%m-%d' ) >= (#{settleDateStart})</if>
			<if test="settleDateEnd !=null and settleDateEnd != ''"> and date_format( create_time ,'%Y-%m-%d' ) &lt;= (#{settleDateEnd})</if>
			<if test="department !=null and department != ''">and  store = #{department}</if>
			<if test="username !=null and username != ''">and  username = #{username}</if>
			<if test="newOld !=null and newOld != ''">and  new_old = #{newOld}</if>
			<if test="storeDescribe != null and storeDescribe != ''">and  store_describe LIKE concat(concat('%', #{storeDescribe}),'%')</if>
			<if test="brandname != null and brandname != ''">and   store_name LIKE concat(concat('%', #{brandname}),'%')</if>
			and ( role_id = 7)
		</where>
	</select>

	<select id="findDoctorPeople" resultType="com.shiguang.storeSales.domain.SalesDO">
		select  u.store,u.username,u.name
		from  sys_user u
		join sys_user_role ur on u.user_id=ur.user_id
		<where>
			<if test="companyId !=null and companyId != ''">and u.company_id in (#{companyId})</if>
			<if test="department !=null and department != ''">and u.store = #{department}</if>
			and (ur.role_id = 9)
		</where>
		GROUP BY u.username
	</select>



	<select id="findCfCount" resultType="int">
		SELECT
		count( 0 )
		FROM
		(
		SELECT
		ptometry_number,
		company_id,
		username,
		role_id,
		create_time,
		store,
		new_old
		FROM
		(
		SELECT
		k.ptometry_number,
		u.company_id,
		u.username,
		ur.role_id,
		jg.create_time,
		u.store ,
		k.new_old
		FROM
		jc_kjjy k
		LEFT JOIN jc_result jg ON jg.ptometry_number = k.ptometry_number
		LEFT JOIN sys_user u ON k.kjjy_doctor = u.
		NAME LEFT JOIN sys_user_role ur ON u.user_id = ur.user_id UNION ALL
		SELECT
		ky.ptometry_number,
		u.company_id,
		u.username,
		ur.role_id,
		jg.create_time,
		u.store,
		ky.new_old
		FROM
		jc_kjyy ky
		LEFT JOIN jc_result jg ON jg.ptometry_number = ky.ptometry_number
		LEFT JOIN sys_user u ON ky.kjyy_doctor = u.
		NAME LEFT JOIN sys_user_role ur ON u.user_id = ur.user_id UNION ALL
		SELECT
		sg.ptometry_number,
		u.company_id,
		u.username,
		ur.role_id,
		jg.create_time,
		u.store,
		sg.new_old
		FROM
		jc_sgjj sg
		LEFT JOIN jc_result jg ON jg.ptometry_number = sg.ptometry_number
		LEFT JOIN sys_user u ON sg.sgjj_doctor = u.
		NAME LEFT JOIN sys_user_role ur ON u.user_id = ur.user_id UNION ALL
		SELECT
		z.ptometry_number,
		u.company_id,
		u.username,
		ur.role_id,
		jg.create_time,
		u.store,
		z.new_old
		FROM
		jc_zy z
		LEFT JOIN jc_result jg ON jg.ptometry_number = z.ptometry_number
		LEFT JOIN sys_user u ON z.zy_doctor = u.
		NAME LEFT JOIN sys_user_role ur ON u.user_id = ur.user_id UNION ALL
		SELECT
		x.ptometry_number,
		u.company_id,
		u.username,
		ur.role_id,
		jg.create_time,
		u.store,
		x.new_old
		FROM
		jc_rxjmjcj x
		LEFT JOIN jc_result jg ON jg.ptometry_number = x.ptometry_number
		LEFT JOIN sys_user u ON x.rx_doctor = u.
		NAME LEFT JOIN sys_user_role ur ON u.user_id = ur.user_id UNION ALL
		SELECT
		sx.ptometry_number,
		u.company_id,
		u.username,
		ur.role_id,
		jg.create_time,
		u.store,
		sx.new_old
		FROM
		jc_sjxl sx
		LEFT JOIN jc_result jg ON jg.ptometry_number = sx.ptometry_number
		LEFT JOIN sys_user u ON sx.sjxl_doctor = u.
		NAME LEFT JOIN sys_user_role ur ON u.user_id = ur.user_id UNION ALL
		SELECT
		rg.ptometry_number,
		u.company_id,
		u.username,
		ur.role_id,
		jg.create_time,
		u.store,
		rg.new_old
		FROM
		jc_rgp rg
		LEFT JOIN jc_result jg ON jg.ptometry_number = rg.ptometry_number
		LEFT JOIN sys_user u ON rg.rgp_doctor = u.
		NAME LEFT JOIN sys_user_role ur ON u.user_id = ur.user_id UNION ALL
		SELECT
		cr.ptometry_number,
		u.company_id,
		u.username,
		ur.role_id,
		jg.create_time,
		u.store,
		cr.new_old
		FROM
		jc_crt cr
		LEFT JOIN jc_result jg ON jg.ptometry_number = cr.ptometry_number
		LEFT JOIN sys_user u ON cr.crt_doctor = u.
		NAME LEFT JOIN sys_user_role ur ON u.user_id = ur.user_id UNION ALL
		SELECT
		vst.ptometry_number,
		u.company_id,
		u.username,
		ur.role_id,
		jg.create_time,
		u.store ,
		vst.new_old
		FROM
		jc_vst vst
		LEFT JOIN jc_result jg ON jg.ptometry_number = vst.ptometry_number
		LEFT JOIN sys_user u ON vst.vst_doctor = u.
		NAME LEFT JOIN sys_user_role ur ON u.user_id = ur.user_id UNION ALL
		SELECT
		yp.ptometry_number,
		u.company_id,
		u.username,
		ur.role_id,
		jg.create_time,
		u.store,
		yp.new_old
		FROM
		jc_yaopin yp
		LEFT JOIN jc_result jg ON jg.ptometry_number = yp.ptometry_number
		LEFT JOIN sys_user u ON yp.yp_doctor = u.
		NAME LEFT JOIN sys_user_role ur ON u.user_id = ur.user_id
		) aia
		<where>
			<if test="companyId !=null and companyId != ''">and  company_id in (#{companyId})</if>
			<if test="settleDateStart !=null and settleDateStart != ''"> and date_format( create_time ,'%Y-%m-%d' ) >= (#{settleDateStart})</if>
			<if test="settleDateEnd !=null and settleDateEnd != ''"> and date_format( create_time ,'%Y-%m-%d' ) &lt;= (#{settleDateEnd})</if>
			<if test="department !=null and department != ''">and  store = #{department}</if>
			<if test="username !=null and username != ''">and  username = #{username}</if>
			<if test="newOld !=null and newOld != ''">and  new_old = #{newOld}</if>
			and ( role_id = 9)
		</where>
		) aia

	</select>


	<select id="findCfUseCount"  resultType="int">
		SELECT
		count( 0 )
		FROM
		(
		SELECT
		ptometry_number,
		company_id,
		username,
		role_id,
		create_time,
		store,
		sale_type,
		new_old
		FROM
		(
		SELECT
		k.ptometry_number,
		u.company_id,
		u.username,
		ur.role_id,
		jg.create_time,
		u.store,
		sa.sale_type,
		k.new_old
		FROM
		jc_kjjy k
		JOIN store_sales sa ON sa.ptometry_number = k.ptometry_number
		JOIN jc_result jg ON jg.ptometry_number = k.ptometry_number
		JOIN sys_user u ON k.kjjy_doctor = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id UNION ALL
		SELECT
		ky.ptometry_number,
		u.company_id,
		u.username,
		ur.role_id,
		jg.create_time,
		u.store,
		sa.sale_type,
		ky.new_old
		FROM
		jc_kjyy ky
		JOIN store_sales sa ON sa.ptometry_number = ky.ptometry_number
		JOIN jc_result jg ON jg.ptometry_number = ky.ptometry_number
		JOIN sys_user u ON ky.kjyy_doctor = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id UNION ALL
		SELECT
		sg.ptometry_number,
		u.company_id,
		u.username,
		ur.role_id,
		jg.create_time,
		u.store,
		sa.sale_type,
		sg.new_old
		FROM
		jc_sgjj sg
		JOIN store_sales sa ON sa.ptometry_number = sg.ptometry_number
		JOIN jc_result jg ON jg.ptometry_number = sg.ptometry_number
		JOIN sys_user u ON sg.sgjj_doctor = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id UNION ALL
		SELECT
		z.ptometry_number,
		u.company_id,
		u.username,
		ur.role_id,
		jg.create_time,
		u.store,
		sa.sale_type,
		z.new_old
		FROM
		jc_zy z
		JOIN store_sales sa ON sa.ptometry_number = z.ptometry_number
		JOIN jc_result jg ON jg.ptometry_number = z.ptometry_number
		JOIN sys_user u ON z.zy_doctor = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id UNION ALL
		SELECT
		x.ptometry_number,
		u.company_id,
		u.username,
		ur.role_id,
		jg.create_time,
		u.store,
		sa.sale_type,
		x.new_old
		FROM
		jc_rxjmjcj x
		LEFT JOIN store_sales sa ON sa.ptometry_number = x.ptometry_number
		JOIN jc_result jg ON jg.ptometry_number = x.ptometry_number
		JOIN sys_user u ON x.rx_doctor = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id UNION ALL
		SELECT
		sx.ptometry_number,
		u.company_id,
		u.username,
		ur.role_id,
		jg.create_time,
		u.store,
		sa.sale_type,
		sx.new_old
		FROM
		jc_sjxl sx
		JOIN store_sales sa ON sa.ptometry_number = sx.ptometry_number
		JOIN jc_result jg ON jg.ptometry_number = sx.ptometry_number
		JOIN sys_user u ON sx.sjxl_doctor = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id UNION ALL
		SELECT
		rg.ptometry_number,
		u.company_id,
		u.username,
		ur.role_id,
		jg.create_time,
		u.store,
		sa.sale_type,
		rg.new_old
		FROM
		jc_rgp rg
		JOIN store_sales sa ON sa.ptometry_number = rg.ptometry_number
		JOIN jc_result jg ON jg.ptometry_number = rg.ptometry_number
		JOIN sys_user u ON rg.rgp_doctor = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id UNION ALL
		SELECT
		cr.ptometry_number,
		u.company_id,
		u.username,
		ur.role_id,
		jg.create_time,
		u.store,
		sa.sale_type,
		cr.new_old
		FROM
		jc_crt cr
		JOIN store_sales sa ON sa.ptometry_number = cr.ptometry_number
		JOIN jc_result jg ON jg.ptometry_number = cr.ptometry_number
		JOIN sys_user u ON cr.crt_doctor = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id UNION ALL
		SELECT
		vst.ptometry_number,
		u.company_id,
		u.username,
		ur.role_id,
		jg.create_time,
		u.store,
		sa.sale_type,
		vst.new_old
		FROM
		jc_vst vst
		JOIN store_sales sa ON sa.ptometry_number = vst.ptometry_number
		JOIN jc_result jg ON jg.ptometry_number = vst.ptometry_number
		JOIN sys_user u ON vst.vst_doctor = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id UNION ALL
		SELECT
		yp.ptometry_number,
		u.company_id,
		u.username,
		ur.role_id,
		jg.create_time,
		u.store,
		sa.sale_type,
		yp.new_old
		FROM
		jc_yaopin yp
		JOIN store_sales sa ON sa.ptometry_number = yp.ptometry_number
		JOIN jc_result jg ON jg.ptometry_number = yp.ptometry_number
		JOIN sys_user u ON yp.yp_doctor = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
		) aia
		<where>
			<if test="companyId !=null and companyId != ''">and  company_id in (#{companyId})</if>
			<if test="settleDateStart !=null and settleDateStart != ''"> and date_format( create_time ,'%Y-%m-%d' ) >= (#{settleDateStart})</if>
			<if test="settleDateEnd !=null and settleDateEnd != ''"> and date_format( create_time ,'%Y-%m-%d' ) &lt;= (#{settleDateEnd})</if>
			<if test="department !=null and department != ''">and  store = #{department}</if>
			<if test="username !=null and username != ''">and  username = #{username}</if>
			<if test="newOld !=null and newOld != ''">and  new_old = #{newOld}</if>
			and (role_id = 9)and ( sale_type=1)
		</where>
		) ai
	</select>

	<select id="findCfamountMoney" resultType="int">
		SELECT
		ifnull( sum( amount_money ), 0 ) AS amountMoney
		FROM
		(
		SELECT
		ptometry_number,
		company_id,
		create_time,
		username,
		role_id,
		sale_type,
		store,
		sale_number,
		amount_money,
		new_old
		FROM
		(
		SELECT
		kjyy.ptometry_number,
		u.company_id,
		kjyy.create_time,
		u.username,
		ur.role_id,
		s.sale_type,
		u.store,
		s.sale_number,
		s.amount_money,
		kjyy.new_old
		FROM
		jc_kjyy kjyy
		JOIN sys_user u ON kjyy.kjyy_doctor = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
		JOIN store_sales s ON kjyy.ptometry_number = s.ptometry_number UNION ALL
		SELECT
		kjjy.ptometry_number,
		u.company_id,
		kjjy.create_time,
		u.username,
		ur.role_id,
		s.sale_type,
		u.store,
		s.sale_number,
		s.amount_money,
		kjjy.new_old
		FROM
		jc_kjjy kjjy
		JOIN sys_user u ON kjjy.kjjy_doctor = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
		JOIN store_sales s ON kjjy.ptometry_number = s.ptometry_number UNION ALL
		SELECT
		sgjj.ptometry_number,
		u.company_id,
		sgjj.create_time,
		u.username,
		ur.role_id,
		s.sale_type,
		u.store,
		s.sale_number,
		s.amount_money,
		sgjj.new_old
		FROM
		jc_sgjj sgjj
		JOIN sys_user u ON sgjj.sgjj_doctor = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
		JOIN store_sales s ON sgjj.ptometry_number = s.ptometry_number UNION ALL
		SELECT
		rx.ptometry_number,
		u.company_id,
		rx.create_time,
		u.username,
		ur.role_id,
		s.sale_type,
		u.store,
		s.sale_number,
		s.amount_money,
		rx.new_old
		FROM
		jc_rxjmjcj rx
		JOIN sys_user u ON rx.rx_doctor = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
		JOIN store_sales s ON rx.ptometry_number = s.ptometry_number UNION ALL
		SELECT
		zy.ptometry_number,
		u.company_id,
		zy.create_time,
		u.username,
		ur.role_id,
		s.sale_type,
		u.store,
		s.sale_number,
		s.amount_money,
		zy.new_old
		FROM
		jc_zy zy
		JOIN sys_user u ON zy.zy_doctor = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
		JOIN store_sales s ON zy.ptometry_number = s.ptometry_number UNION ALL
		SELECT
		sjxl.ptometry_number,
		u.company_id,
		sjxl.create_time,
		u.username,
		ur.role_id,
		s.sale_type,
		u.store,
		s.sale_number,
		s.amount_money,
		sjxl.new_old
		FROM
		jc_sjxl sjxl
		JOIN sys_user u ON sjxl.sjxl_doctor = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
		JOIN store_sales s ON sjxl.ptometry_number = s.ptometry_number UNION ALL
		SELECT
		vst.ptometry_number,
		u.company_id,
		vst.create_time,
		u.username,
		ur.role_id,
		s.sale_type,
		u.store,
		s.sale_number,
		s.amount_money,
		vst.new_old
		FROM
		jc_vst vst
		JOIN sys_user u ON vst.vst_doctor = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
		JOIN store_sales s ON vst.ptometry_number = s.ptometry_number UNION ALL
		SELECT
		crt.ptometry_number,
		u.company_id,
		crt.create_time,
		u.username,
		ur.role_id,
		s.sale_type,
		u.store,
		s.sale_number,
		s.amount_money,
		crt.new_old
		FROM
		jc_crt crt
		JOIN sys_user u ON crt.crt_doctor = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
		JOIN store_sales s ON crt.ptometry_number = s.ptometry_number UNION ALL
		SELECT
		rgp.ptometry_number,
		u.company_id,
		rgp.create_time,
		u.username,
		ur.role_id,
		s.sale_type,
		u.store,
		s.sale_number,
		s.amount_money,
		rgp.new_old
		FROM
		jc_rgp rgp
		JOIN sys_user u ON rgp.rgp_doctor = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
		JOIN store_sales s ON rgp.ptometry_number = s.ptometry_number UNION ALL
		SELECT
		yp.ptometry_number,
		u.company_id,
		yp.create_time,
		u.username,
		ur.role_id,
		s.sale_type,
		u.store,
		s.sale_number,
		s.amount_money,
		yp.new_old
		FROM
		jc_yaopin yp
		JOIN sys_user u ON yp.yp_doctor = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
		JOIN store_sales s ON yp.ptometry_number = s.ptometry_number
		) aia
		<where>
			<if test="companyId !=null and companyId != ''">and  company_id in (#{companyId})</if>
			<if test="settleDateStart !=null and settleDateStart != ''"> and date_format( create_time ,'%Y-%m-%d' ) >= (#{settleDateStart})</if>
			<if test="settleDateEnd !=null and settleDateEnd != ''"> and date_format( create_time ,'%Y-%m-%d' ) &lt;= (#{settleDateEnd})</if>
			<if test="department !=null and department != ''">and  store = #{department}</if>
			<if test="username !=null and username != ''">and  username = #{username}</if>
			<if test="newOld !=null and newOld != ''">and  new_old = #{newOld}</if>
			and ( role_id = 9)and ( sale_type=1)
		</where>
		GROUP BY
		sale_number
		) ai

	</select>

	<select id="findDoctorGoods" resultType="com.shiguang.storeSales.domain.SalesDO">
		SELECT
		company_id,
		store,
		username,
		role_id,
		NAME,
		sale_number,
		goods_num,
		store_name,
		store_describe,
		classtype,
		store_count,
		store_unit,
		amount_money,
		sale_type,
		create_time,
		new_old
		FROM
		(
		SELECT
		u.company_id,
		u.store,
		u.username,
		ur.role_id,
		u.NAME,
		s.sale_number,
		s.goods_num,
		s.store_name,
		s.store_describe,
		s.classtype,
		s.store_count,
		s.store_unit,
		s.amount_money,
		s.sale_type,
		kjyy.create_time,
		kjyy.new_old
		FROM
		jc_kjyy kjyy
		JOIN sys_user u ON kjyy.kjyy_doctor = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
		JOIN store_sales s ON kjyy.ptometry_number = s.ptometry_number UNION ALL
		SELECT
		u.company_id,
		u.store,
		u.username,
		ur.role_id,
		u.NAME,
		s.sale_number,
		s.goods_num,
		s.store_name,
		s.store_describe,
		s.classtype,
		s.store_count,
		s.store_unit,
		s.amount_money,
		s.sale_type,
		kjjy.create_time,
		kjjy.new_old
		FROM
		jc_kjjy kjjy
		JOIN sys_user u ON kjjy.kjjy_doctor = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
		JOIN store_sales s ON kjjy.ptometry_number = s.ptometry_number UNION ALL
		SELECT
		u.company_id,
		u.store,
		u.username,
		ur.role_id,
		u.NAME,
		s.sale_number,
		s.goods_num,
		s.store_name,
		s.store_describe,
		s.classtype,
		s.store_count,
		s.store_unit,
		s.amount_money,
		s.sale_type,
		sgjj.create_time,
		sgjj.new_old
		FROM
		jc_sgjj sgjj
		JOIN sys_user u ON sgjj.sgjj_doctor = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
		JOIN store_sales s ON sgjj.ptometry_number = s.ptometry_number UNION ALL
		SELECT
		u.company_id,
		u.store,
		u.username,
		ur.role_id,
		u.NAME,
		s.sale_number,
		s.goods_num,
		s.store_name,
		s.store_describe,
		s.classtype,
		s.store_count,
		s.store_unit,
		s.amount_money,
		s.sale_type,
		rx.create_time,
		rx.new_old
		FROM
		jc_rxjmjcj rx
		JOIN sys_user u ON rx.rx_doctor = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
		JOIN store_sales s ON rx.ptometry_number = s.ptometry_number UNION ALL
		SELECT
		u.company_id,
		u.store,
		u.username,
		ur.role_id,
		u.NAME,
		s.sale_number,
		s.goods_num,
		s.store_name,
		s.store_describe,
		s.classtype,
		s.store_count,
		s.store_unit,
		s.amount_money,
		s.sale_type,
		zy.create_time,
		zy.new_old
		FROM
		jc_zy zy
		JOIN sys_user u ON zy.zy_doctor = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
		JOIN store_sales s ON zy.ptometry_number = s.ptometry_number UNION ALL
		SELECT
		u.company_id,
		u.store,
		u.username,
		ur.role_id,
		u.NAME,
		s.sale_number,
		s.goods_num,
		s.store_name,
		s.store_describe,
		s.classtype,
		s.store_count,
		s.store_unit,
		s.amount_money,
		s.sale_type,
		sjxl.create_time,
		sjxl.new_old
		FROM
		jc_sjxl sjxl
		JOIN sys_user u ON sjxl.sjxl_doctor = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
		JOIN store_sales s ON sjxl.ptometry_number = s.ptometry_number UNION ALL
		SELECT
		u.company_id,
		u.store,
		u.username,
		ur.role_id,
		u.NAME,
		s.sale_number,
		s.goods_num,
		s.store_name,
		s.store_describe,
		s.classtype,
		s.store_count,
		s.store_unit,
		s.amount_money,
		s.sale_type,
		vst.create_time,
		vst.new_old
		FROM
		jc_vst vst
		JOIN sys_user u ON vst.vst_doctor = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
		JOIN store_sales s ON vst.ptometry_number = s.ptometry_number UNION ALL
		SELECT
		u.company_id,
		u.store,
		u.username,
		ur.role_id,
		u.NAME,
		s.sale_number,
		s.goods_num,
		s.store_name,
		s.store_describe,
		s.classtype,
		s.store_count,
		s.store_unit,
		s.amount_money,
		s.sale_type,
		crt.create_time,
		crt.new_old
		FROM
		jc_crt crt
		JOIN sys_user u ON crt.crt_doctor = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
		JOIN store_sales s ON crt.ptometry_number = s.ptometry_number UNION ALL
		SELECT
		u.company_id,
		u.store,
		u.username,
		ur.role_id,
		u.NAME,
		s.sale_number,
		s.goods_num,
		s.store_name,
		s.store_describe,
		s.classtype,
		s.store_count,
		s.store_unit,
		s.amount_money,
		s.sale_type,
		rgp.create_time,
		rgp.new_old
		FROM
		jc_rgp rgp
		JOIN sys_user u ON rgp.rgp_doctor = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
		JOIN store_sales s ON rgp.ptometry_number = s.ptometry_number UNION ALL
		SELECT
		u.company_id,
		u.store,
		u.username,
		ur.role_id,
		u.NAME,
		s.sale_number,
		s.goods_num,
		s.store_name,
		s.store_describe,
		s.classtype,
		s.store_count,
		s.store_unit,
		s.amount_money,
		s.sale_type,
		yp.create_time,
		yp.new_old
		FROM
		jc_yaopin yp
		JOIN sys_user u ON yp.yp_doctor = u.
		NAME JOIN sys_user_role ur ON u.user_id = ur.user_id
		JOIN store_sales s ON yp.ptometry_number = s.ptometry_number
		) aia
		<where>
			<if test="companyId !=null and companyId != ''">and  company_id in (#{companyId})</if>
			<if test="settleDateStart !=null and settleDateStart != ''"> and date_format( create_time ,'%Y-%m-%d' ) >= (#{settleDateStart})</if>
			<if test="settleDateEnd !=null and settleDateEnd != ''"> and date_format( create_time ,'%Y-%m-%d' ) &lt;= (#{settleDateEnd})</if>
			<if test="department !=null and department != ''">and  store = #{department}</if>
			<if test="username !=null and username != ''">and  username = #{username}</if>
			<if test="newOld !=null and newOld != ''">and  new_old = #{newOld}</if>
			<if test="storeDescribe != null and storeDescribe != ''">and  store_describe LIKE concat(concat('%', #{storeDescribe}),'%')</if>
			<if test="brandname != null and brandname != ''">and   store_name LIKE concat(concat('%', #{brandname}),'%')</if>
			and ( role_id = 9) and ( sale_type=1)
		</where>
		GROUP BY
		sale_number


	</select>


    <select id="Yg" resultType="com.shiguang.storeSales.domain.SalesDO">
        SELECT
        ptometry_number,
        yg,
        company_id,
        username,
        role_id,
        create_time,
        store,
        new_old
        FROM
        (
        SELECT
        k.ptometry_number,
        k.kjjy_optometry_name as yg,
        u.company_id,
        u.username,
        ur.role_id,
        jg.create_time,
        u.store,
        k.new_old
        FROM
        jc_kjjy k
        LEFT JOIN jc_result jg ON jg.ptometry_number = k.ptometry_number
        LEFT JOIN sys_user u ON k.kjjy_doctor = u. NAME
        LEFT JOIN sys_user_role ur ON u.user_id = ur.user_id
        UNION ALL
        SELECT
        ky.ptometry_number,
        ky.kjyy_optometry_name as yg,
        u.company_id,
        u.username,
        ur.role_id,
        jg.create_time,
        u.store,
        ky.new_old
        FROM
        jc_kjyy ky
        LEFT JOIN jc_result jg ON jg.ptometry_number = ky.ptometry_number
        LEFT JOIN sys_user u ON ky.kjyy_doctor = u. NAME
        LEFT JOIN sys_user_role ur ON u.user_id = ur.user_id
        UNION ALL
        SELECT
        sg.ptometry_number,
        sg.sgjj_optometry_name as yg,
        u.company_id,
        u.username,
        ur.role_id,
        jg.create_time,
        u.store,
        sg.new_old
        FROM
        jc_sgjj sg
        LEFT JOIN jc_result jg ON jg.ptometry_number = sg.ptometry_number
        LEFT JOIN sys_user u ON sg.sgjj_doctor = u. NAME
        LEFT JOIN sys_user_role ur ON u.user_id = ur.user_id
        UNION ALL
        SELECT
        z.ptometry_number,
        z.zy_optometry_name as yg,
        u.company_id,
        u.username,
        ur.role_id,
        jg.create_time,
        u.store,
        z.new_old
        FROM
        jc_zy z
        LEFT JOIN jc_result jg ON jg.ptometry_number = z.ptometry_number
        LEFT JOIN sys_user u ON z.zy_doctor = u. NAME
        LEFT JOIN sys_user_role ur ON u.user_id = ur.user_id
        UNION ALL
        SELECT
        x.ptometry_number,
        x.rx_optometry_name as yg,
        u.company_id,
        u.username,
        ur.role_id,
        jg.create_time,
        u.store,
        x.new_old
        FROM
        jc_rxjmjcj x
        LEFT JOIN jc_result jg ON jg.ptometry_number = x.ptometry_number
        LEFT JOIN sys_user u ON x.rx_doctor = u. NAME
        LEFT JOIN sys_user_role ur ON u.user_id = ur.user_id
        UNION ALL
        SELECT
        sx.ptometry_number,
        sx.sjxl_optometry_name as yg,
        u.company_id,
        u.username,
        ur.role_id,
        jg.create_time,
        u.store,
        sx.new_old
        FROM
        jc_sjxl sx
        LEFT JOIN jc_result jg ON jg.ptometry_number = sx.ptometry_number
        LEFT JOIN sys_user u ON sx.sjxl_doctor = u. NAME
        LEFT JOIN sys_user_role ur ON u.user_id = ur.user_id
        UNION ALL
        SELECT
        rg.ptometry_number,
        rg.rgp_optometry_name as yg,
        u.company_id,
        u.username,
        ur.role_id,
        jg.create_time,
        u.store,
        rg.new_old
        FROM
        jc_rgp rg
        LEFT JOIN jc_result jg ON jg.ptometry_number = rg.ptometry_number
        LEFT JOIN sys_user u ON rg.rgp_doctor = u. NAME
        LEFT JOIN sys_user_role ur ON u.user_id = ur.user_id
        UNION ALL
        SELECT
        cr.ptometry_number,
        cr.crt_optometry_name as yg,
        u.company_id,
        u.username,
        ur.role_id,
        jg.create_time,
        u.store,
        cr.new_old
        FROM
        jc_crt cr
        LEFT JOIN jc_result jg ON jg.ptometry_number = cr.ptometry_number
        LEFT JOIN sys_user u ON cr.crt_doctor = u. NAME
        LEFT JOIN sys_user_role ur ON u.user_id = ur.user_id
        UNION ALL
        SELECT
        vst.ptometry_number,
        vst.vst_optometry_name as yg,
        u.company_id,
        u.username,
        ur.role_id,
        jg.create_time,
        u.store,
        vst.new_old
        FROM
        jc_vst vst
        LEFT JOIN jc_result jg ON jg.ptometry_number = vst.ptometry_number
        LEFT JOIN sys_user u ON vst.vst_doctor = u. NAME
        LEFT JOIN sys_user_role ur ON u.user_id = ur.user_id
        UNION ALL
        SELECT
        yp.ptometry_number,
        yp.yp_optometry_name as yg,
        u.company_id,
        u.username,
        ur.role_id,
        jg.create_time,
        u.store,
        yp.new_old
        FROM
        jc_yaopin yp
        LEFT JOIN jc_result jg ON jg.ptometry_number = yp.ptometry_number
        LEFT JOIN sys_user u ON yp.yp_doctor = u. NAME
        LEFT JOIN sys_user_role ur ON u.user_id = ur.user_id
        ) aia
        <where>
            <if test="companyId !=null and companyId != ''">and  company_id in (#{companyId})</if>
            <if test="settleDateStart !=null and settleDateStart != ''"> and date_format( create_time ,'%Y-%m-%d' ) >= (#{settleDateStart})</if>
            <if test="settleDateEnd !=null and settleDateEnd != ''"> and date_format( create_time ,'%Y-%m-%d' ) &lt;= (#{settleDateEnd})</if>
            <if test="department !=null and department != ''">and  store = #{department}</if>
            <if test="username !=null and username != ''">and  username = #{username}</if>
            <if test="newOld !=null and newOld != ''">and  new_old = #{newOld}</if>
            <if test="storeDescribe != null and storeDescribe != ''">and  store_describe LIKE concat(concat('%', #{storeDescribe}),'%')</if>
            <if test="brandname != null and brandname != ''">and   store_name LIKE concat(concat('%', #{brandname}),'%')</if>
            and ( role_id = 9)
        </where>



    </select>
    <select id="YgUse" resultType="com.shiguang.storeSales.domain.SalesDO">
		SELECT
		ptometry_number,
		yg,
		company_id,
		username,
		role_id,
		create_time,
		store,
		sale_type,
		new_old
		FROM
		(
		SELECT
		k.ptometry_number,
		k.kjjy_optometry_name as yg,
		u.company_id,
		u.username,
		ur.role_id,
		jg.create_time,
		u.store,
		sa.sale_type,
		k.new_old
		FROM
		jc_kjjy k
		JOIN store_sales sa ON sa.ptometry_number = k.ptometry_number
		JOIN jc_result jg ON jg.ptometry_number = k.ptometry_number
		JOIN sys_user u ON k.kjjy_doctor = u. NAME
		JOIN sys_user_role ur ON u.user_id = ur.user_id
		UNION ALL
		SELECT
		ky.ptometry_number,
		ky.kjyy_optometry_name as yg,
		u.company_id,
		u.username,
		ur.role_id,
		jg.create_time,
		u.store,
		sa.sale_type,
		ky.new_old
		FROM
		jc_kjyy ky
		JOIN store_sales sa ON sa.ptometry_number = ky.ptometry_number
		JOIN jc_result jg ON jg.ptometry_number = ky.ptometry_number
		JOIN sys_user u ON ky.kjyy_doctor = u. NAME
		JOIN sys_user_role ur ON u.user_id = ur.user_id
		UNION ALL
		SELECT
		sg.ptometry_number,
		sg.sgjj_optometry_name as yg,
		u.company_id,
		u.username,
		ur.role_id,
		jg.create_time,
		u.store,
		sa.sale_type,
		sg.new_old
		FROM
		jc_sgjj sg
		JOIN store_sales sa ON sa.ptometry_number = sg.ptometry_number
		JOIN jc_result jg ON jg.ptometry_number = sg.ptometry_number
		JOIN sys_user u ON sg.sgjj_doctor = u. NAME
		JOIN sys_user_role ur ON u.user_id = ur.user_id
		UNION ALL
		SELECT
		z.ptometry_number,
		z.zy_optometry_name as yg,
		u.company_id,
		u.username,
		ur.role_id,
		jg.create_time,
		u.store,
		sa.sale_type,
		z.new_old
		FROM
		jc_zy z
		JOIN store_sales sa ON sa.ptometry_number = z.ptometry_number
		JOIN jc_result jg ON jg.ptometry_number = z.ptometry_number
		JOIN sys_user u ON z.zy_doctor = u. NAME
		JOIN sys_user_role ur ON u.user_id = ur.user_id
		UNION ALL
		SELECT
		x.ptometry_number,
		x.rx_optometry_name as yg,
		u.company_id,
		u.username,
		ur.role_id,
		jg.create_time,
		u.store,
		sa.sale_type,
		x.new_old
		FROM
		jc_rxjmjcj x
		LEFT JOIN store_sales sa ON sa.ptometry_number = x.ptometry_number
		JOIN jc_result jg ON jg.ptometry_number = x.ptometry_number
		JOIN sys_user u ON x.rx_doctor = u. NAME
		JOIN sys_user_role ur ON u.user_id = ur.user_id
		UNION ALL
		SELECT
		sx.ptometry_number,
		sx.sjxl_optometry_name as yg,
		u.company_id,
		u.username,
		ur.role_id,
		jg.create_time,
		u.store,
		sa.sale_type,
		sx.new_old
		FROM
		jc_sjxl sx
		JOIN store_sales sa ON sa.ptometry_number = sx.ptometry_number
		JOIN jc_result jg ON jg.ptometry_number = sx.ptometry_number
		JOIN sys_user u ON sx.sjxl_doctor = u. NAME
		JOIN sys_user_role ur ON u.user_id = ur.user_id
		UNION ALL
		SELECT
		rg.ptometry_number,
		rg.rgp_optometry_name as yg,
		u.company_id,
		u.username,
		ur.role_id,
		jg.create_time,
		u.store,
		sa.sale_type,
		rg.new_old
		FROM
		jc_rgp rg
		JOIN store_sales sa ON sa.ptometry_number = rg.ptometry_number
		JOIN jc_result jg ON jg.ptometry_number = rg.ptometry_number
		JOIN sys_user u ON rg.rgp_doctor = u. NAME
		JOIN sys_user_role ur ON u.user_id = ur.user_id
		UNION ALL
		SELECT
		cr.ptometry_number,
		cr.crt_optometry_name as yg,
		u.company_id,
		u.username,
		ur.role_id,
		jg.create_time,
		u.store,
		sa.sale_type,
		cr.new_old
		FROM
		jc_crt cr
		JOIN store_sales sa ON sa.ptometry_number = cr.ptometry_number
		JOIN jc_result jg ON jg.ptometry_number = cr.ptometry_number
		JOIN sys_user u ON cr.crt_doctor = u. NAME
		JOIN sys_user_role ur ON u.user_id = ur.user_id
		UNION ALL
		SELECT
		vst.ptometry_number,
		vst.vst_optometry_name as yg,
		u.company_id,
		u.username,
		ur.role_id,
		jg.create_time,
		u.store,
		sa.sale_type,
		vst.new_old
		FROM
		jc_vst vst
		JOIN store_sales sa ON sa.ptometry_number = vst.ptometry_number
		JOIN jc_result jg ON jg.ptometry_number = vst.ptometry_number
		JOIN sys_user u ON vst.vst_doctor = u. NAME
		JOIN sys_user_role ur ON u.user_id = ur.user_id
		UNION ALL
		SELECT
		yp.ptometry_number,
		yp.yp_optometry_name as yg,
		u.company_id,
		u.username,
		ur.role_id,
		jg.create_time,
		u.store,
		sa.sale_type,
		yp.new_old
		FROM
		jc_yaopin yp
		JOIN store_sales sa ON sa.ptometry_number = yp.ptometry_number
		JOIN jc_result jg ON jg.ptometry_number = yp.ptometry_number
		JOIN sys_user u ON yp.yp_doctor = u. NAME
		JOIN sys_user_role ur ON u.user_id = ur.user_id
		) aia
        <where>
            <if test="companyId !=null and companyId != ''">and  company_id in (#{companyId})</if>
            <if test="settleDateStart !=null and settleDateStart != ''"> and date_format( create_time ,'%Y-%m-%d' ) >= (#{settleDateStart})</if>
            <if test="settleDateEnd !=null and settleDateEnd != ''"> and date_format( create_time ,'%Y-%m-%d' ) &lt;= (#{settleDateEnd})</if>
            <if test="department !=null and department != ''">and  store = #{department}</if>
            <if test="username !=null and username != ''">and  username = #{username}</if>
            <if test="newOld !=null and newOld != ''">and  new_old = #{newOld}</if>
            <if test="storeDescribe != null and storeDescribe != ''">and  store_describe LIKE concat(concat('%', #{storeDescribe}),'%')</if>
            <if test="brandname != null and brandname != ''">and   store_name LIKE concat(concat('%', #{brandname}),'%')</if>
            AND (role_id = 9)
            AND (sale_type = 1)
        </where>



    </select>

</mapper>