<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.shiguang.product.dao.JpcpDao">

    <select id="get" resultType="com.shiguang.product.domain.JpcpDO">
        select j.`id`,j.`produc_num`,j.`produc_code`,j.`produc_name`,j.`mfrsid`,j.`brandid`,j.`brandnum`,j.`proid`,j.`unitid`,j.`sph_id`,j.`cyl_id`,
        j.`lightbelow_id`,j.`lens_id`,j.`batchid`,j.`light_id`,j.`gradual_id`,j.`refractivityid`,j.`function_id`,j.`tax`,j.`tax_price`,
        j.`trade_price`,j.`transfer_price`,j.`retail_price` ,j.`status`,j.`state`,
        m.mfrsname,b.brandname,u.unitname,l.cyl,s.sph
        from aa_jpcp j left join c_mfrs m on j.mfrsid=m.mfrsid left join c_brand b on j.brandnum=b.brandnum left join
        c_unit u on j.unitid= u.unitid  left join a_cyl l on l.cyl_id=j.cyl_id left join a_sph s on s.sph_id=j.sph_id
        where id = #{value}
    </select>
    <!--//修改时显示制造商和商品品种名称-->
    <select id="list" resultType="com.shiguang.product.domain.JpcpDO">
        select
        j.`id`,j.`produc_num`,j.`produc_code`,j.`produc_name`,j.`mfrsid`,j.`brandid`,j.`brandnum`,j.`proid`,j.`unitid`,j.`sph_id`,j.`cyl_id`,
        j.`lightbelow_id`,j.`lens_id`,j.`batchid`,j.`light_id`,j.`gradual_id`,j.`refractivityid`,j.`function_id`,j.`tax`,j.`tax_price`,
        j.`trade_price`,j.`transfer_price`,j.`retail_price`,j.`status`,j.`state`,
        m.mfrsname,b.brandname,u.unitname,l.cyl,s.sph
        from aa_jpcp j left join c_mfrs m on j.mfrsid=m.mfrsid left join c_brand b on j.brandnum=b.brandnum left join
        c_unit u on j.unitid= u.unitid left join a_cyl l on l.cyl_id=j.cyl_id left join a_sph s on s.sph_id=j.sph_id
        <where>
            <if test="producNum != null and producNum != ''">and j.produc_num = #{producNum}</if>
            <if test="producName != null and producName != ''">and j.produc_name = #{producName}</if>
            <if test="mfrsname != null and mfrsname != ''">and m.mfrsname = #{mfrsname}</if>
            <if test="brandname != null and brandname != ''">and b.brandname = #{brandname}</if>
            <if test="retailPrice != null and retailPrice != ''">
                and j.retail_price between #{retailPrice,jdbcType=VARCHAR} and #{retailPrice2,jdbcType=VARCHAR}
            </if>
            <if test="taxPrice != null and taxPrice != ''">
                and j.tax_price between #{taxPrice,jdbcType=VARCHAR} and #{taxPrice2,jdbcType=VARCHAR}
            </if>


            <if test="lensId != null and lensId != ''">and j.lens_id = #{lensId}</if>
            <if test="refractivityid != null and refractivityid != ''">and j.refractivityid = #{refractivityid}</if>
            <if test="lightId != null and lightId != ''">and j.light_id = #{lightId}</if>

            <if test="sph != null and sph != ''">
            and s.sph between #{sph,jdbcType=VARCHAR} and (#{sph2,jdbcType=VARCHAR})
        </if>
            <if test="cyl != null and cyl != ''">
                and l.cyl between #{cyl,jdbcType=VARCHAR} and #{cyl2,jdbcType=VARCHAR}
            </if>
            <if test="status != null and status != ''">and j.status = #{status}</if>
            and j.state= 1
        </where>
        group by j.id order by j.status asc ,j.id asc
    </select>
    <select id="count" resultType="int">
        select count(*) from aa_jpcp
        <where>
            <if test="id != null and id != ''">and id = #{id}</if>
            <if test="producNum != null and producNum != ''">and produc_num = #{producNum}</if>
            <if test="producCode != null and producCode != ''">and produc_code = #{producCode}</if>
            <if test="producName != null and producName != ''">and produc_name = #{producName}</if>
            <if test="mfrsid != null and mfrsid != ''">and mfrsid = #{mfrsid}</if>
            <if test="brandid != null and brandid != ''">and brandid = #{brandid}</if>
            <if test="brandnum != null and brandnum != ''">and brandnum = #{brandnum}</if>
            <if test="proid != null and proid != ''">and proid = #{proid}</if>
            <if test="unitid != null and unitid != ''">and unitid = #{unitid}</if>
            <if test="sphId != null and sphId != ''">and sph_id = #{sphId}</if>
            <if test="cylId != null and cylId != ''">and cyl_id = #{cylId}</if>
            <if test="lightbelowId != null and lightbelowId != ''">and lightbelow_id = #{lightbelowId}</if>
            <if test="lensId != null and lensId != ''">and lens_id = #{lensId}</if>
            <if test="batchid != null and batchid != ''">and batchid = #{batchid}</if>
            <if test="lightId != null and lightId != ''">and light_id = #{lightId}</if>
            <if test="gradualId != null and gradualId != ''">and gradual_id = #{gradualId}</if>
            <if test="refractivityid != null and refractivityid != ''">and refractivityid = #{refractivityid}</if>
            <if test="functionId != null and functionId != ''">and function_id = #{functionId}</if>
            <if test="tax != null and tax != ''">and tax = #{tax}</if>
            <if test="taxPrice != null and taxPrice != ''">and tax_price = #{taxPrice}</if>
            <if test="tradePrice != null and tradePrice != ''">and trade_price = #{tradePrice}</if>
            <if test="transferPrice != null and transferPrice != ''">and transfer_price = #{transferPrice}</if>
            <if test="retailPrice != null and retailPrice != ''">and retail_price = #{retailPrice}</if>
            <if test="status != null and status != ''">and status = #{status}</if>
            <if test="state != null and state != ''">and state = #{state}</if>
        </where>
    </select>

    <insert id="save" parameterType="com.shiguang.product.domain.JpcpDO" useGeneratedKeys="true" keyProperty="id">
		insert into aa_jpcp
		(
			`produc_num`, 
			`produc_code`, 
			`produc_name`, 
			`mfrsid`, 
			`brandid`, 
			`brandnum`,
			`proid`,
			`unitid`, 
			`sph_id`, 
			`cyl_id`, 
			`lightbelow_id`, 
			`lens_id`, 
			`batchid`, 
			`light_id`, 
			`gradual_id`, 
			`refractivityid`, 
			`function_id`, 
			`tax`, 
			`tax_price`, 
			`trade_price`, 
			`transfer_price`, 
			`retail_price`,
			`status`,
			`state`
		)
		values
		(
			#{producNum}, 
			#{producCode}, 
			#{producName}, 
			#{mfrsid}, 
			#{brandid}, 
			#{brandnum},
			#{proid},
			#{unitid}, 
			#{sphId}, 
			#{cylId}, 
			#{lightbelowId}, 
			#{lensId}, 
			#{batchid}, 
			#{lightId}, 
			#{gradualId}, 
			#{refractivityid}, 
			#{functionId}, 
			#{tax}, 
			#{taxPrice}, 
			#{tradePrice}, 
			#{transferPrice}, 
			#{retailPrice},
			#{status},
			#{state}
		)
	</insert>
    <!--//修改停用启用-->
    <update id="update" parameterType="com.shiguang.product.domain.JpcpDO">
        update aa_jpcp
        <set>
            <if test="producNum != null">`produc_num` = #{producNum},</if>
            <if test="producCode != null">`produc_code` = #{producCode},</if>
            <if test="producName != null">`produc_name` = #{producName},</if>
            <if test="mfrsid != null">`mfrsid` = #{mfrsid},</if>
            <if test="brandid != null">`brandid` = #{brandid},</if>
            <if test="brandnum != null">`brandnum` = #{brandnum},</if>
            <if test="proid != null">`proid` = #{proid},</if>
            <if test="unitid != null">`unitid` = #{unitid},</if>
            <if test="sphId != null">`sph_id` = #{sphId},</if>
            <if test="cylId != null">`cyl_id` = #{cylId},</if>
            <if test="lightbelowId != null">`lightbelow_id` = #{lightbelowId},</if>
            <if test="lensId != null">`lens_id` = #{lensId},</if>
            <if test="batchid != null">`batchid` = #{batchid},</if>
            <if test="lightId != null">`light_id` = #{lightId},</if>
            <if test="gradualId != null">`gradual_id` = #{gradualId},</if>
            <if test="refractivityid != null">`refractivityid` = #{refractivityid},</if>
            <if test="functionId != null">`function_id` = #{functionId},</if>
            <if test="tax != null">`tax` = #{tax},</if>
            <if test="taxPrice != null">`tax_price` = #{taxPrice},</if>
            <if test="tradePrice != null">`trade_price` = #{tradePrice},</if>
            <if test="transferPrice != null">`transfer_price` = #{transferPrice},</if>
            <if test="retailPrice != null">`retail_price` = #{retailPrice},</if>
            <if test="status != null">`status` = #{status},</if>
            <if test="state != null">`state` = #{state}</if>
        </set>
        where id = #{id}
    </update>

    <delete id="remove">
		delete from aa_jpcp where id = #{value}
	</delete>

    <delete id="batchRemove">
        delete from aa_jpcp where id in
        <foreach item="id" collection="array" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>

    <!--菜单联动显示-->
    <select id="choice" resultType="com.shiguang.product.domain.JpcpDO">
		select  brandid,brandnum ,brandname  from c_brand  where mfrsid=#{mfrsid} and goodsid=#{goodsid} group by brandid
	</select>
    <!--删除状态修改-->
    <update id="updateState" parameterType="com.shiguang.product.domain.JpcpDO">
    update aa_jpcp set `state` = #{state} where id = #{id}
    </update>
</mapper>